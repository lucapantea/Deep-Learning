Running robustness experiment on CIFAR10 with ./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:07<09:12,  7.08s/it]  3%|▎         | 2/79 [00:07<03:54,  3.04s/it]  4%|▍         | 3/79 [00:07<02:12,  1.75s/it]  5%|▌         | 4/79 [00:07<01:25,  1.14s/it]  6%|▋         | 5/79 [00:07<00:59,  1.24it/s]  8%|▊         | 6/79 [00:08<00:44,  1.63it/s]  9%|▉         | 7/79 [00:08<00:34,  2.08it/s] 10%|█         | 8/79 [00:08<00:28,  2.51it/s] 11%|█▏        | 9/79 [00:08<00:23,  2.93it/s] 13%|█▎        | 10/79 [00:09<00:20,  3.32it/s] 14%|█▍        | 11/79 [00:09<00:18,  3.65it/s] 15%|█▌        | 12/79 [00:09<00:17,  3.92it/s] 16%|█▋        | 13/79 [00:09<00:16,  4.12it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.27it/s] 19%|█▉        | 15/79 [00:10<00:14,  4.38it/s] 20%|██        | 16/79 [00:10<00:14,  4.48it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.52it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.58it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.60it/s] 25%|██▌       | 20/79 [00:11<00:12,  4.57it/s] 27%|██▋       | 21/79 [00:11<00:12,  4.61it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.64it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.64it/s] 30%|███       | 24/79 [00:12<00:11,  4.66it/s] 32%|███▏      | 25/79 [00:12<00:11,  4.68it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.69it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.70it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.70it/s] 37%|███▋      | 29/79 [00:13<00:10,  4.70it/s] 38%|███▊      | 30/79 [00:13<00:10,  4.71it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.70it/s] 41%|████      | 32/79 [00:13<00:10,  4.70it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.69it/s] 43%|████▎     | 34/79 [00:14<00:09,  4.69it/s] 44%|████▍     | 35/79 [00:14<00:09,  4.69it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.68it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.67it/s] 48%|████▊     | 38/79 [00:15<00:08,  4.67it/s] 49%|████▉     | 39/79 [00:15<00:08,  4.67it/s] 51%|█████     | 40/79 [00:15<00:08,  4.67it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.64it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.65it/s] 54%|█████▍    | 43/79 [00:16<00:07,  4.65it/s] 56%|█████▌    | 44/79 [00:16<00:07,  4.65it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.66it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.68it/s] 61%|██████    | 48/79 [00:17<00:06,  4.67it/s] 62%|██████▏   | 49/79 [00:17<00:06,  4.68it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.67it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:18<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:18<00:05,  4.69it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.67it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:19<00:04,  4.68it/s] 73%|███████▎  | 58/79 [00:19<00:04,  4.67it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.67it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.65it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.67it/s] 78%|███████▊  | 62/79 [00:20<00:03,  4.67it/s] 80%|███████▉  | 63/79 [00:20<00:03,  4.67it/s] 81%|████████  | 64/79 [00:20<00:03,  4.67it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.67it/s] 84%|████████▎ | 66/79 [00:21<00:02,  4.68it/s] 85%|████████▍ | 67/79 [00:21<00:02,  4.68it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.65it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.66it/s] 90%|████████▉ | 71/79 [00:22<00:01,  4.65it/s] 91%|█████████ | 72/79 [00:22<00:01,  4.66it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.65it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.66it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.67it/s] 96%|█████████▌| 76/79 [00:23<00:00,  4.67it/s] 97%|█████████▋| 77/79 [00:23<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.67it/s]100%|██████████| 79/79 [00:23<00:00,  3.32it/s]
Validate: [ 0/79]	Time  7.092 ( 7.092)	Loss 9.0625e+00 (9.0625e+00)	Prompt Acc@1  90.62 ( 90.62)
Validate: [10/79]	Time  0.214 ( 0.841)	Loss 1.8609e+01 (1.1565e+01)	Prompt Acc@1  88.28 ( 90.70)
Validate: [20/79]	Time  0.212 ( 0.543)	Loss 1.7219e+01 (1.2638e+01)	Prompt Acc@1  87.50 ( 90.03)
Validate: [30/79]	Time  0.215 ( 0.436)	Loss 2.0391e+01 (1.3791e+01)	Prompt Acc@1  91.41 ( 89.34)
Validate: [40/79]	Time  0.219 ( 0.382)	Loss 1.5430e+01 (1.3686e+01)	Prompt Acc@1  83.59 ( 89.18)
Validate: [50/79]	Time  0.213 ( 0.349)	Loss 1.7781e+01 (1.4443e+01)	Prompt Acc@1  85.94 ( 88.77)
Validate: [60/79]	Time  0.213 ( 0.327)	Loss 1.4156e+01 (1.4202e+01)	Prompt Acc@1  87.50 ( 88.92)
Validate: [70/79]	Time  0.216 ( 0.311)	Loss 1.5578e+01 (1.4319e+01)	Prompt Acc@1  86.72 ( 88.85)
 * Prompt Acc@1 88.770
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:42,  6.70s/it]  3%|▎         | 2/79 [00:06<03:41,  2.88s/it]  4%|▍         | 3/79 [00:07<02:06,  1.67s/it]  5%|▌         | 4/79 [00:07<01:22,  1.10s/it]  6%|▋         | 5/79 [00:07<00:57,  1.29it/s]  8%|▊         | 6/79 [00:07<00:42,  1.71it/s]  9%|▉         | 7/79 [00:07<00:33,  2.15it/s] 10%|█         | 8/79 [00:08<00:27,  2.60it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.02it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.39it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.72it/s] 15%|█▌        | 12/79 [00:09<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.14it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.28it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.29it/s] 20%|██        | 16/79 [00:09<00:14,  4.31it/s] 22%|██▏       | 17/79 [00:10<00:14,  4.40it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.50it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.49it/s] 25%|██▌       | 20/79 [00:10<00:13,  4.51it/s] 27%|██▋       | 21/79 [00:11<00:12,  4.50it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.55it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.57it/s] 30%|███       | 24/79 [00:11<00:11,  4.61it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.65it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.67it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.68it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.56it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.58it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.63it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.66it/s] 41%|████      | 32/79 [00:13<00:10,  4.68it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.70it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.68it/s] 44%|████▍     | 35/79 [00:14<00:09,  4.67it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.67it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.64it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.64it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.56it/s] 51%|█████     | 40/79 [00:15<00:08,  4.55it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.58it/s] 53%|█████▎    | 42/79 [00:15<00:08,  4.61it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.63it/s] 56%|█████▌    | 44/79 [00:16<00:07,  4.63it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.65it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.67it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:17<00:06,  4.67it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.68it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.69it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.70it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.69it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.70it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.67it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.67it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.68it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.68it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.67it/s] 80%|███████▉  | 63/79 [00:20<00:03,  4.67it/s] 81%|████████  | 64/79 [00:20<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.67it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.67it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.67it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.67it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.68it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.68it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.68it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.67it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.68it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.66it/s] 97%|█████████▋| 77/79 [00:23<00:00,  4.67it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.64it/s]100%|██████████| 79/79 [00:23<00:00,  3.36it/s]
Validate: [ 0/79]	Time  6.707 ( 6.707)	Loss 9.1094e+00 (9.1094e+00)	Prompt Acc@1  89.84 ( 89.84)
Validate: [10/79]	Time  0.211 ( 0.805)	Loss 1.8734e+01 (1.1518e+01)	Prompt Acc@1  88.28 ( 90.77)
Validate: [20/79]	Time  0.223 ( 0.526)	Loss 1.6828e+01 (1.2615e+01)	Prompt Acc@1  86.72 ( 90.14)
Validate: [30/79]	Time  0.212 ( 0.426)	Loss 2.0453e+01 (1.3805e+01)	Prompt Acc@1  91.41 ( 89.49)
Validate: [40/79]	Time  0.214 ( 0.375)	Loss 1.3172e+01 (1.3616e+01)	Prompt Acc@1  85.16 ( 89.39)
Validate: [50/79]	Time  0.214 ( 0.343)	Loss 1.7891e+01 (1.4358e+01)	Prompt Acc@1  86.72 ( 89.03)
Validate: [60/79]	Time  0.214 ( 0.322)	Loss 1.4188e+01 (1.4128e+01)	Prompt Acc@1  87.50 ( 89.23)
Validate: [70/79]	Time  0.213 ( 0.307)	Loss 1.5578e+01 (1.4242e+01)	Prompt Acc@1  86.72 ( 89.15)
 * Prompt Acc@1 89.010
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2826]],

         [[0.5782]],

         [[0.7989]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
Running robustness experiment on CIFAR10 with ./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 6)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:54,  6.86s/it]  3%|▎         | 2/79 [00:07<03:47,  2.95s/it]  4%|▍         | 3/79 [00:07<02:09,  1.70s/it]  5%|▌         | 4/79 [00:07<01:23,  1.12s/it]  6%|▋         | 5/79 [00:07<00:58,  1.26it/s]  8%|▊         | 6/79 [00:07<00:43,  1.68it/s]  9%|▉         | 7/79 [00:08<00:33,  2.13it/s] 10%|█         | 8/79 [00:08<00:27,  2.57it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.00it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.38it/s] 14%|█▍        | 11/79 [00:09<00:18,  3.70it/s] 15%|█▌        | 12/79 [00:09<00:16,  3.97it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.18it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.33it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.44it/s] 20%|██        | 16/79 [00:10<00:13,  4.52it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.54it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.59it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.46it/s] 25%|██▌       | 20/79 [00:10<00:13,  4.50it/s] 27%|██▋       | 21/79 [00:11<00:12,  4.55it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.61it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.65it/s] 30%|███       | 24/79 [00:11<00:11,  4.63it/s] 32%|███▏      | 25/79 [00:12<00:11,  4.58it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.62it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.66it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.55it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.61it/s] 38%|███▊      | 30/79 [00:13<00:10,  4.65it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.66it/s] 41%|████      | 32/79 [00:13<00:10,  4.67it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.66it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.65it/s] 44%|████▍     | 35/79 [00:14<00:09,  4.62it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.64it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.65it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.66it/s] 49%|████▉     | 39/79 [00:15<00:08,  4.62it/s] 51%|█████     | 40/79 [00:15<00:08,  4.64it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.57it/s] 53%|█████▎    | 42/79 [00:15<00:08,  4.59it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.61it/s] 56%|█████▌    | 44/79 [00:16<00:07,  4.62it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.62it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.63it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.63it/s] 61%|██████    | 48/79 [00:16<00:06,  4.64it/s] 62%|██████▏   | 49/79 [00:17<00:06,  4.65it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.66it/s] 65%|██████▍   | 51/79 [00:17<00:06,  4.64it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.65it/s] 67%|██████▋   | 53/79 [00:18<00:05,  4.66it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.66it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.67it/s] 71%|███████   | 56/79 [00:18<00:04,  4.67it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.66it/s] 73%|███████▎  | 58/79 [00:19<00:04,  4.66it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.65it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.65it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.65it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.64it/s] 80%|███████▉  | 63/79 [00:20<00:03,  4.64it/s] 81%|████████  | 64/79 [00:20<00:03,  4.65it/s] 82%|████████▏ | 65/79 [00:20<00:03,  4.65it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.66it/s] 85%|████████▍ | 67/79 [00:21<00:02,  4.66it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.65it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.66it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.65it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.66it/s] 91%|█████████ | 72/79 [00:22<00:01,  4.66it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.67it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.67it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.67it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.67it/s] 97%|█████████▋| 77/79 [00:23<00:00,  4.67it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.67it/s]100%|██████████| 79/79 [00:23<00:00,  3.34it/s]
Validate: [ 0/79]	Time  6.863 ( 6.863)	Loss 9.0859e+00 (9.0859e+00)	Prompt Acc@1  91.41 ( 91.41)
Validate: [10/79]	Time  0.212 ( 0.819)	Loss 1.8547e+01 (1.1561e+01)	Prompt Acc@1  88.28 ( 90.70)
Validate: [20/79]	Time  0.213 ( 0.532)	Loss 1.7234e+01 (1.2645e+01)	Prompt Acc@1  87.50 ( 90.03)
Validate: [30/79]	Time  0.214 ( 0.430)	Loss 2.0375e+01 (1.3806e+01)	Prompt Acc@1  91.41 ( 89.36)
Validate: [40/79]	Time  0.227 ( 0.378)	Loss 1.5375e+01 (1.3697e+01)	Prompt Acc@1  83.59 ( 89.21)
Validate: [50/79]	Time  0.217 ( 0.346)	Loss 1.7797e+01 (1.4444e+01)	Prompt Acc@1  85.94 ( 88.82)
Validate: [60/79]	Time  0.215 ( 0.324)	Loss 1.4266e+01 (1.4209e+01)	Prompt Acc@1  87.50 ( 88.99)
Validate: [70/79]	Time  0.214 ( 0.309)	Loss 1.5570e+01 (1.4324e+01)	Prompt Acc@1  86.72 ( 88.91)
 * Prompt Acc@1 88.800
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 6)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:07<09:09,  7.05s/it]  3%|▎         | 2/79 [00:07<03:53,  3.04s/it]  4%|▍         | 3/79 [00:07<02:12,  1.75s/it]  5%|▌         | 4/79 [00:07<01:25,  1.14s/it]  6%|▋         | 5/79 [00:07<00:59,  1.24it/s]  8%|▊         | 6/79 [00:08<00:44,  1.65it/s]  9%|▉         | 7/79 [00:08<00:35,  2.05it/s] 10%|█         | 8/79 [00:08<00:28,  2.49it/s] 11%|█▏        | 9/79 [00:08<00:23,  2.92it/s] 13%|█▎        | 10/79 [00:09<00:20,  3.31it/s] 14%|█▍        | 11/79 [00:09<00:18,  3.62it/s] 15%|█▌        | 12/79 [00:09<00:17,  3.83it/s] 16%|█▋        | 13/79 [00:09<00:16,  4.06it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.23it/s] 19%|█▉        | 15/79 [00:10<00:14,  4.34it/s] 20%|██        | 16/79 [00:10<00:14,  4.43it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.51it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.50it/s] 24%|██▍       | 19/79 [00:11<00:14,  4.27it/s] 25%|██▌       | 20/79 [00:11<00:13,  4.40it/s] 27%|██▋       | 21/79 [00:11<00:13,  4.40it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.45it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.51it/s] 30%|███       | 24/79 [00:12<00:12,  4.58it/s] 32%|███▏      | 25/79 [00:12<00:12,  4.33it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.43it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.51it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.58it/s] 37%|███▋      | 29/79 [00:13<00:10,  4.62it/s] 38%|███▊      | 30/79 [00:13<00:10,  4.62it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.65it/s] 41%|████      | 32/79 [00:13<00:10,  4.68it/s] 42%|████▏     | 33/79 [00:14<00:09,  4.68it/s] 43%|████▎     | 34/79 [00:14<00:09,  4.68it/s] 44%|████▍     | 35/79 [00:14<00:09,  4.69it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.69it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.67it/s] 48%|████▊     | 38/79 [00:15<00:08,  4.66it/s] 49%|████▉     | 39/79 [00:15<00:08,  4.68it/s] 51%|█████     | 40/79 [00:15<00:08,  4.69it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.59it/s] 53%|█████▎    | 42/79 [00:16<00:08,  4.60it/s] 54%|█████▍    | 43/79 [00:16<00:07,  4.63it/s] 56%|█████▌    | 44/79 [00:16<00:07,  4.64it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.66it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:17<00:06,  4.67it/s] 61%|██████    | 48/79 [00:17<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:17<00:06,  4.69it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.69it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.69it/s] 66%|██████▌   | 52/79 [00:18<00:05,  4.69it/s] 67%|██████▋   | 53/79 [00:18<00:05,  4.68it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.68it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:19<00:04,  4.69it/s] 73%|███████▎  | 58/79 [00:19<00:04,  4.68it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.66it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.67it/s] 77%|███████▋  | 61/79 [00:20<00:03,  4.67it/s] 78%|███████▊  | 62/79 [00:20<00:03,  4.66it/s] 80%|███████▉  | 63/79 [00:20<00:03,  4.66it/s] 81%|████████  | 64/79 [00:20<00:03,  4.66it/s] 82%|████████▏ | 65/79 [00:20<00:03,  4.66it/s] 84%|████████▎ | 66/79 [00:21<00:02,  4.66it/s] 85%|████████▍ | 67/79 [00:21<00:02,  4.65it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.65it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.65it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.65it/s] 90%|████████▉ | 71/79 [00:22<00:01,  4.64it/s] 91%|█████████ | 72/79 [00:22<00:01,  4.65it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.66it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.65it/s] 95%|█████████▍| 75/79 [00:23<00:00,  4.66it/s] 96%|█████████▌| 76/79 [00:23<00:00,  4.67it/s] 97%|█████████▋| 77/79 [00:23<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.62it/s]100%|██████████| 79/79 [00:23<00:00,  3.29it/s]
Validate: [ 0/79]	Time  7.053 ( 7.053)	Loss 8.9922e+00 (8.9922e+00)	Prompt Acc@1  91.41 ( 91.41)
Validate: [10/79]	Time  0.217 ( 0.840)	Loss 1.9000e+01 (1.1550e+01)	Prompt Acc@1  87.50 ( 90.98)
Validate: [20/79]	Time  0.228 ( 0.546)	Loss 1.7562e+01 (1.2669e+01)	Prompt Acc@1  86.72 ( 90.22)
Validate: [30/79]	Time  0.211 ( 0.440)	Loss 2.0391e+01 (1.3850e+01)	Prompt Acc@1  91.41 ( 89.57)
Validate: [40/79]	Time  0.228 ( 0.385)	Loss 1.3742e+01 (1.3666e+01)	Prompt Acc@1  84.38 ( 89.41)
Validate: [50/79]	Time  0.213 ( 0.352)	Loss 1.7875e+01 (1.4402e+01)	Prompt Acc@1  85.94 ( 89.05)
Validate: [60/79]	Time  0.213 ( 0.329)	Loss 1.4016e+01 (1.4164e+01)	Prompt Acc@1  87.50 ( 89.22)
Validate: [70/79]	Time  0.217 ( 0.313)	Loss 1.5625e+01 (1.4294e+01)	Prompt Acc@1  86.72 ( 89.14)
 * Prompt Acc@1 89.000
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3412]],

         [[0.5041]],

         [[0.4052]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
Running robustness experiment on CIFAR10 with ./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 7)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:20,  6.42s/it]  3%|▎         | 2/79 [00:06<03:33,  2.77s/it]  4%|▍         | 3/79 [00:06<02:02,  1.62s/it]  5%|▌         | 4/79 [00:07<01:19,  1.07s/it]  6%|▋         | 5/79 [00:07<00:56,  1.32it/s]  8%|▊         | 6/79 [00:07<00:41,  1.75it/s]  9%|▉         | 7/79 [00:07<00:32,  2.21it/s] 10%|█         | 8/79 [00:07<00:26,  2.66it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.08it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.45it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.74it/s] 15%|█▌        | 12/79 [00:08<00:16,  4.00it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.19it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.33it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.44it/s] 20%|██        | 16/79 [00:09<00:13,  4.52it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.53it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.58it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.59it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.61it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.65it/s] 28%|██▊       | 22/79 [00:10<00:12,  4.67it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.69it/s] 30%|███       | 24/79 [00:11<00:11,  4.71it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.72it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.72it/s] 34%|███▍      | 27/79 [00:11<00:11,  4.71it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.72it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.72it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.72it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.72it/s] 41%|████      | 32/79 [00:13<00:10,  4.69it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.70it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.60it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.62it/s] 46%|████▌     | 36/79 [00:13<00:09,  4.64it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.64it/s] 48%|████▊     | 38/79 [00:14<00:09,  4.35it/s] 49%|████▉     | 39/79 [00:14<00:09,  4.44it/s] 51%|█████     | 40/79 [00:14<00:09,  4.28it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.39it/s] 53%|█████▎    | 42/79 [00:15<00:08,  4.47it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.51it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.55it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.59it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.62it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.63it/s] 61%|██████    | 48/79 [00:16<00:06,  4.64it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.65it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.66it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.67it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.68it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.69it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.70it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.69it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.70it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.70it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.71it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.70it/s] 81%|████████  | 64/79 [00:19<00:03,  4.69it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.69it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.70it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.70it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.67it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.69it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.68it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.68it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.69it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.68it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.68it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:22<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.40it/s]
Validate: [ 0/79]	Time  6.424 ( 6.424)	Loss 8.7188e+00 (8.7188e+00)	Prompt Acc@1  90.62 ( 90.62)
Validate: [10/79]	Time  0.215 ( 0.780)	Loss 1.9531e+01 (1.0669e+01)	Prompt Acc@1  87.50 ( 90.62)
Validate: [20/79]	Time  0.211 ( 0.510)	Loss 1.5328e+01 (1.1849e+01)	Prompt Acc@1  88.28 ( 90.29)
Validate: [30/79]	Time  0.211 ( 0.414)	Loss 1.8797e+01 (1.3026e+01)	Prompt Acc@1  91.41 ( 89.72)
Validate: [40/79]	Time  0.214 ( 0.368)	Loss 1.4414e+01 (1.2902e+01)	Prompt Acc@1  85.16 ( 89.60)
Validate: [50/79]	Time  0.212 ( 0.338)	Loss 1.7516e+01 (1.3688e+01)	Prompt Acc@1  85.94 ( 89.20)
Validate: [60/79]	Time  0.212 ( 0.317)	Loss 1.5656e+01 (1.3580e+01)	Prompt Acc@1  88.28 ( 89.34)
Validate: [70/79]	Time  0.214 ( 0.303)	Loss 1.5977e+01 (1.3720e+01)	Prompt Acc@1  87.50 ( 89.26)
 * Prompt Acc@1 89.150
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 7)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:05,  6.23s/it]  3%|▎         | 2/79 [00:06<03:27,  2.69s/it]  4%|▍         | 3/79 [00:06<01:59,  1.57s/it]  5%|▌         | 4/79 [00:06<01:17,  1.03s/it]  6%|▋         | 5/79 [00:07<00:54,  1.36it/s]  8%|▊         | 6/79 [00:07<00:40,  1.79it/s]  9%|▉         | 7/79 [00:07<00:32,  2.24it/s] 10%|█         | 8/79 [00:07<00:26,  2.69it/s] 11%|█▏        | 9/79 [00:07<00:22,  3.11it/s] 13%|█▎        | 10/79 [00:08<00:19,  3.47it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.77it/s] 15%|█▌        | 12/79 [00:08<00:16,  4.02it/s] 16%|█▋        | 13/79 [00:08<00:15,  4.20it/s] 18%|█▊        | 14/79 [00:09<00:14,  4.36it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.47it/s] 20%|██        | 16/79 [00:09<00:13,  4.53it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.59it/s] 23%|██▎       | 18/79 [00:09<00:13,  4.62it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.57it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.59it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.63it/s] 28%|██▊       | 22/79 [00:10<00:12,  4.65it/s] 29%|██▉       | 23/79 [00:10<00:12,  4.61it/s] 30%|███       | 24/79 [00:11<00:11,  4.60it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.65it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.68it/s] 34%|███▍      | 27/79 [00:11<00:11,  4.69it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.69it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.60it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.64it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.67it/s] 41%|████      | 32/79 [00:12<00:10,  4.68it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.69it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.69it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.68it/s] 46%|████▌     | 36/79 [00:13<00:09,  4.68it/s] 47%|████▋     | 37/79 [00:13<00:08,  4.68it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.69it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.69it/s] 51%|█████     | 40/79 [00:14<00:08,  4.69it/s] 52%|█████▏    | 41/79 [00:14<00:08,  4.65it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.65it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.66it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.66it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.30it/s] 58%|█████▊    | 46/79 [00:15<00:07,  4.28it/s] 59%|█████▉    | 47/79 [00:16<00:07,  4.40it/s] 61%|██████    | 48/79 [00:16<00:06,  4.48it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.54it/s] 63%|██████▎   | 50/79 [00:16<00:06,  4.58it/s] 65%|██████▍   | 51/79 [00:17<00:06,  4.60it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.62it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.62it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.64it/s] 70%|██████▉   | 55/79 [00:17<00:05,  4.65it/s] 71%|███████   | 56/79 [00:18<00:04,  4.66it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.66it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.68it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.67it/s] 76%|███████▌  | 60/79 [00:18<00:04,  4.68it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.67it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.68it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.69it/s] 81%|████████  | 64/79 [00:19<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.68it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.70it/s] 87%|████████▋ | 69/79 [00:20<00:02,  4.70it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.69it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.69it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.68it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.68it/s] 94%|█████████▎| 74/79 [00:21<00:01,  4.69it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.67it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:22<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.43it/s]
Validate: [ 0/79]	Time  6.236 ( 6.236)	Loss 8.3672e+00 (8.3672e+00)	Prompt Acc@1  89.84 ( 89.84)
Validate: [10/79]	Time  0.212 ( 0.762)	Loss 1.7219e+01 (1.1456e+01)	Prompt Acc@1  89.84 ( 90.62)
Validate: [20/79]	Time  0.210 ( 0.501)	Loss 1.4633e+01 (1.2082e+01)	Prompt Acc@1  88.28 ( 90.33)
Validate: [30/79]	Time  0.211 ( 0.409)	Loss 1.8656e+01 (1.3245e+01)	Prompt Acc@1  91.41 ( 89.62)
Validate: [40/79]	Time  0.219 ( 0.361)	Loss 1.1820e+01 (1.3191e+01)	Prompt Acc@1  84.38 ( 89.56)
Validate: [50/79]	Time  0.215 ( 0.334)	Loss 1.7969e+01 (1.4083e+01)	Prompt Acc@1  85.94 ( 89.14)
Validate: [60/79]	Time  0.215 ( 0.314)	Loss 1.5477e+01 (1.3887e+01)	Prompt Acc@1  88.28 ( 89.36)
Validate: [70/79]	Time  0.212 ( 0.300)	Loss 1.3750e+01 (1.3989e+01)	Prompt Acc@1  89.06 ( 89.37)
 * Prompt Acc@1 89.280
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.1630, 0.7439, 0.4425, 0.7714, 0.4519],
          [0.8097, 0.3699, 0.6457, 0.4960, 0.0394],
          [0.9180, 0.0932, 0.7717, 0.0866, 0.8884],
          [0.4716, 0.5611, 0.1537, 0.8067, 0.4638],
          [0.5043, 0.3371, 0.8457, 0.1496, 0.5545]],

         [[0.3862, 0.9780, 0.2021, 0.8658, 0.7233],
          [0.3285, 0.0016, 0.7122, 0.5260, 0.6455],
          [0.1033, 0.5561, 0.5169, 0.8661, 0.5622],
          [0.8094, 0.6485, 0.8905, 0.5830, 0.2760],
          [0.5823, 0.7759, 0.5749, 0.3154, 0.8989]],

         [[0.2361, 0.0068, 0.4988, 0.7703, 0.1617],
          [0.9898, 0.8201, 0.4846, 0.9294, 0.4120],
          [0.7802, 0.9830, 0.4809, 0.6208, 0.4735],
          [0.3289, 0.2585, 0.1787, 0.2291, 0.3630],
          [0.9489, 0.0794, 0.1376, 0.7376, 0.0020]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
Running robustness experiment on CIFAR10 with ./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:44,  6.72s/it]  3%|▎         | 2/79 [00:06<03:43,  2.90s/it]  4%|▍         | 3/79 [00:07<02:07,  1.67s/it]  5%|▌         | 4/79 [00:07<01:22,  1.10s/it]  6%|▋         | 5/79 [00:07<00:57,  1.29it/s]  8%|▊         | 6/79 [00:07<00:42,  1.71it/s]  9%|▉         | 7/79 [00:08<00:33,  2.16it/s] 10%|█         | 8/79 [00:08<00:27,  2.60it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.02it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.37it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.70it/s] 15%|█▌        | 12/79 [00:09<00:16,  3.96it/s] 16%|█▋        | 13/79 [00:09<00:16,  4.10it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.28it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.41it/s] 20%|██        | 16/79 [00:09<00:14,  4.46it/s] 22%|██▏       | 17/79 [00:10<00:14,  4.42it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.50it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.57it/s] 25%|██▌       | 20/79 [00:10<00:13,  4.53it/s] 27%|██▋       | 21/79 [00:11<00:12,  4.58it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.60it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.54it/s] 30%|███       | 24/79 [00:11<00:12,  4.57it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.62it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.66it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.56it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.61it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.64it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.67it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.69it/s] 41%|████      | 32/79 [00:13<00:09,  4.70it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.69it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.68it/s] 44%|████▍     | 35/79 [00:14<00:09,  4.64it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.65it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.66it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.67it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.69it/s] 51%|█████     | 40/79 [00:15<00:08,  4.68it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.69it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.69it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.68it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.70it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.69it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.69it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.68it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:17<00:06,  4.69it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.69it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.69it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.68it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.70it/s] 71%|███████   | 56/79 [00:18<00:04,  4.65it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.67it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.69it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.70it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.70it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.69it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.70it/s] 80%|███████▉  | 63/79 [00:20<00:03,  4.70it/s] 81%|████████  | 64/79 [00:20<00:03,  4.69it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.70it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.70it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.70it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.71it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.71it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.70it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.71it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.68it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.65it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.67it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.67it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:23<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.37it/s]
Validate: [ 0/79]	Time  6.733 ( 6.733)	Loss 1.1328e+01 (1.1328e+01)	Prompt Acc@1  89.84 ( 89.84)
Validate: [10/79]	Time  0.212 ( 0.807)	Loss 2.0547e+01 (1.1643e+01)	Prompt Acc@1  89.84 ( 90.13)
Validate: [20/79]	Time  0.213 ( 0.526)	Loss 1.3867e+01 (1.2463e+01)	Prompt Acc@1  89.84 ( 90.36)
Validate: [30/79]	Time  0.211 ( 0.426)	Loss 1.8875e+01 (1.3620e+01)	Prompt Acc@1  90.62 ( 89.72)
Validate: [40/79]	Time  0.213 ( 0.374)	Loss 1.3969e+01 (1.3674e+01)	Prompt Acc@1  83.59 ( 89.65)
Validate: [50/79]	Time  0.213 ( 0.343)	Loss 1.6672e+01 (1.4435e+01)	Prompt Acc@1  89.06 ( 89.40)
Validate: [60/79]	Time  0.214 ( 0.321)	Loss 1.7516e+01 (1.4550e+01)	Prompt Acc@1  85.94 ( 89.42)
Validate: [70/79]	Time  0.212 ( 0.306)	Loss 1.5578e+01 (1.4700e+01)	Prompt Acc@1  87.50 ( 89.39)
 * Prompt Acc@1 89.220
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2944, 0.0943, 0.3208, 0.7669, 0.0902, 0.8749, 0.9191, 0.8755,
           0.8764, 0.2271],
          [0.8145, 0.9031, 0.3309, 0.1265, 0.3635, 0.7434, 0.8294, 0.9195,
           0.4738, 0.3521],
          [0.5336, 0.9923, 0.3957, 0.0774, 0.9433, 0.0446, 0.4547, 0.1888,
           0.7086, 0.7953],
          [0.1650, 0.2662, 0.8909, 0.1468, 0.4939, 0.0200, 0.4918, 0.0011,
           0.6062, 0.8613],
          [0.9868, 0.9109, 0.1555, 0.7530, 0.2551, 0.6777, 0.5797, 0.2688,
           0.9084, 0.9214],
          [0.4199, 0.6976, 0.8231, 0.0411, 0.7022, 0.6293, 0.4115, 0.8230,
           0.0919, 0.6212],
          [0.6203, 0.7103, 0.4868, 0.4824, 0.6853, 0.5350, 0.4269, 0.0673,
           0.1118, 0.7143],
          [0.3814, 0.1865, 0.2592, 0.2781, 0.3327, 0.0706, 0.2643, 0.2846,
           0.3605, 0.6188],
          [0.3752, 0.2611, 0.5325, 0.8757, 0.0747, 0.3397, 0.9444, 0.6790,
           0.7437, 0.6924],
          [0.7331, 0.5330, 0.5082, 0.1059, 0.8607, 0.2272, 0.4269, 0.7751,
           0.6215, 0.2285]],

         [[0.8077, 0.5452, 0.6899, 0.2479, 0.1487, 0.2955, 0.8703, 0.5110,
           0.4144, 0.1115],
          [0.2612, 0.5316, 0.6025, 0.7348, 0.7209, 0.8170, 0.2284, 0.1190,
           0.1653, 0.0866],
          [0.9587, 0.9629, 0.3307, 0.0420, 0.5832, 0.3234, 0.2224, 0.0638,
           0.5002, 0.1116],
          [0.4938, 0.9848, 0.7428, 0.5688, 0.3055, 0.2001, 0.0801, 0.6377,
           0.1468, 0.0995],
          [0.1209, 0.2809, 0.9201, 0.4697, 0.6569, 0.1869, 0.4916, 0.0115,
           0.3177, 0.3178],
          [0.8072, 0.8394, 0.8373, 0.1716, 0.1152, 0.3062, 0.4086, 0.5585,
           0.3896, 0.6176],
          [0.6853, 0.4357, 0.5597, 0.4421, 0.4542, 0.2541, 0.5480, 0.3435,
           0.4822, 0.0792],
          [0.0736, 0.8425, 0.4270, 0.4381, 0.2848, 0.3251, 0.2173, 0.6370,
           0.8388, 0.0945],
          [0.9652, 0.5703, 0.7352, 0.9996, 0.8130, 0.2014, 0.8307, 0.6315,
           0.4324, 0.2724],
          [0.3529, 0.0943, 0.9538, 0.3813, 0.2046, 0.8717, 0.4411, 0.9301,
           0.7892, 0.9522]],

         [[0.3067, 0.6942, 0.6117, 0.7611, 0.8474, 0.2351, 0.7752, 0.1539,
           0.4289, 0.8462],
          [0.8504, 0.4108, 0.3248, 0.4680, 0.0195, 0.6752, 0.1061, 0.7232,
           0.2453, 0.2653],
          [0.6014, 0.4237, 0.5641, 0.1508, 0.3446, 0.6151, 0.0049, 0.7199,
           0.1171, 0.9050],
          [0.3049, 0.4495, 0.2480, 0.2225, 0.3806, 0.4152, 0.2220, 0.2398,
           0.8434, 0.8707],
          [0.3280, 0.6937, 0.7019, 0.7371, 0.1284, 0.3866, 0.9618, 0.7491,
           0.6993, 0.8823],
          [0.5088, 0.9914, 0.4989, 0.9906, 0.3046, 0.5023, 0.5534, 0.7530,
           0.0897, 0.0050],
          [0.0539, 0.0295, 0.0290, 0.5315, 0.1467, 0.0450, 0.5287, 0.6765,
           0.2605, 0.0140],
          [0.8046, 0.1170, 0.8790, 0.3045, 0.3850, 0.3156, 0.8784, 0.7179,
           0.0762, 0.7652],
          [0.4740, 0.6344, 0.4686, 0.4016, 0.9211, 0.6504, 0.7069, 0.8691,
           0.2557, 0.6087],
          [0.8163, 0.4109, 0.2114, 0.8237, 0.1449, 0.3473, 0.9238, 0.6433,
           0.9526, 0.4639]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:42,  6.70s/it]  3%|▎         | 2/79 [00:06<03:41,  2.88s/it]  4%|▍         | 3/79 [00:07<02:06,  1.67s/it]  5%|▌         | 4/79 [00:07<01:21,  1.09s/it]  6%|▋         | 5/79 [00:07<00:57,  1.29it/s]  8%|▊         | 6/79 [00:07<00:42,  1.71it/s]  9%|▉         | 7/79 [00:07<00:33,  2.16it/s] 10%|█         | 8/79 [00:08<00:27,  2.61it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.04it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.41it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.74it/s] 15%|█▌        | 12/79 [00:09<00:17,  3.93it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.13it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.29it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.42it/s] 20%|██        | 16/79 [00:09<00:14,  4.42it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.45it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.53it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.51it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.58it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.62it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.65it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.68it/s] 30%|███       | 24/79 [00:11<00:11,  4.70it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.66it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.62it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.66it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.69it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.69it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.70it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.72it/s] 41%|████      | 32/79 [00:13<00:09,  4.72it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.72it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.56it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.56it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.59it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.62it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.63it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.65it/s] 51%|█████     | 40/79 [00:15<00:08,  4.64it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.66it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.66it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.57it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.58it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.62it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.63it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.65it/s] 61%|██████    | 48/79 [00:16<00:06,  4.66it/s] 62%|██████▏   | 49/79 [00:17<00:06,  4.67it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.67it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.67it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.67it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.68it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.68it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.69it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.70it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.70it/s] 81%|████████  | 64/79 [00:20<00:03,  4.70it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.70it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.70it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.68it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.65it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.67it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.68it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.70it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.70it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.69it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.67it/s]100%|██████████| 79/79 [00:23<00:00,  3.37it/s]
Validate: [ 0/79]	Time  6.703 ( 6.703)	Loss 1.1266e+01 (1.1266e+01)	Prompt Acc@1  89.84 ( 89.84)
Validate: [10/79]	Time  0.210 ( 0.803)	Loss 1.6109e+01 (1.3388e+01)	Prompt Acc@1  88.28 ( 89.20)
Validate: [20/79]	Time  0.211 ( 0.524)	Loss 1.8281e+01 (1.4417e+01)	Prompt Acc@1  89.06 ( 89.43)
Validate: [30/79]	Time  0.211 ( 0.423)	Loss 1.5266e+01 (1.5337e+01)	Prompt Acc@1  91.41 ( 88.86)
Validate: [40/79]	Time  0.212 ( 0.373)	Loss 1.6516e+01 (1.5585e+01)	Prompt Acc@1  82.81 ( 88.64)
Validate: [50/79]	Time  0.213 ( 0.342)	Loss 1.9969e+01 (1.6499e+01)	Prompt Acc@1  85.94 ( 88.16)
Validate: [60/79]	Time  0.213 ( 0.321)	Loss 1.6656e+01 (1.6337e+01)	Prompt Acc@1  88.28 ( 88.26)
Validate: [70/79]	Time  0.213 ( 0.306)	Loss 1.2562e+01 (1.6366e+01)	Prompt Acc@1  87.50 ( 88.15)
 * Prompt Acc@1 88.010
Running robustness experiment on CIFAR10 with ./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:23,  6.46s/it]  3%|▎         | 2/79 [00:06<03:35,  2.79s/it]  4%|▍         | 3/79 [00:06<02:02,  1.62s/it]  5%|▌         | 4/79 [00:07<01:19,  1.06s/it]  6%|▋         | 5/79 [00:07<00:55,  1.32it/s]  8%|▊         | 6/79 [00:07<00:42,  1.73it/s]  9%|▉         | 7/79 [00:07<00:33,  2.18it/s] 10%|█         | 8/79 [00:07<00:27,  2.62it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.05it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.42it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.73it/s] 15%|█▌        | 12/79 [00:08<00:16,  3.97it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.18it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.32it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.41it/s] 20%|██        | 16/79 [00:09<00:13,  4.50it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.55it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.53it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.57it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.59it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.63it/s] 28%|██▊       | 22/79 [00:10<00:12,  4.66it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.67it/s] 30%|███       | 24/79 [00:11<00:11,  4.67it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.69it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.70it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.71it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.70it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.69it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.69it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.71it/s] 41%|████      | 32/79 [00:13<00:09,  4.72it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.72it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.72it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.69it/s] 46%|████▌     | 36/79 [00:13<00:09,  4.69it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.67it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.68it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.66it/s] 51%|█████     | 40/79 [00:14<00:08,  4.67it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.66it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.65it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.51it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.55it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.59it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.62it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.63it/s] 61%|██████    | 48/79 [00:16<00:06,  4.64it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.65it/s] 63%|██████▎   | 50/79 [00:16<00:06,  4.65it/s] 65%|██████▍   | 51/79 [00:17<00:06,  4.63it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.65it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.66it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.66it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.68it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.69it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.68it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.68it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.67it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.68it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.68it/s] 81%|████████  | 64/79 [00:19<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.68it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.67it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.67it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.66it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.67it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.69it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.68it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.68it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.67it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.68it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.68it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:22<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.40it/s]
Validate: [ 0/79]	Time  6.466 ( 6.466)	Loss 8.5859e+00 (8.5859e+00)	Prompt Acc@1  89.06 ( 89.06)
Validate: [10/79]	Time  0.213 ( 0.785)	Loss 1.9359e+01 (1.0611e+01)	Prompt Acc@1  87.50 ( 90.41)
Validate: [20/79]	Time  0.211 ( 0.513)	Loss 1.5109e+01 (1.1791e+01)	Prompt Acc@1  88.28 ( 90.36)
Validate: [30/79]	Time  0.211 ( 0.416)	Loss 1.9000e+01 (1.2931e+01)	Prompt Acc@1  91.41 ( 89.77)
Validate: [40/79]	Time  0.215 ( 0.367)	Loss 1.3969e+01 (1.2804e+01)	Prompt Acc@1  85.16 ( 89.63)
Validate: [50/79]	Time  0.218 ( 0.337)	Loss 1.8000e+01 (1.3586e+01)	Prompt Acc@1  86.72 ( 89.26)
Validate: [60/79]	Time  0.215 ( 0.317)	Loss 1.5938e+01 (1.3506e+01)	Prompt Acc@1  88.28 ( 89.40)
Validate: [70/79]	Time  0.212 ( 0.303)	Loss 1.5758e+01 (1.3629e+01)	Prompt Acc@1  87.50 ( 89.34)
 * Prompt Acc@1 89.210
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:14,  6.33s/it]  3%|▎         | 2/79 [00:06<03:30,  2.74s/it]  4%|▍         | 3/79 [00:06<02:00,  1.59s/it]  5%|▌         | 4/79 [00:06<01:18,  1.04s/it]  6%|▋         | 5/79 [00:07<00:54,  1.35it/s]  8%|▊         | 6/79 [00:07<00:41,  1.78it/s]  9%|▉         | 7/79 [00:07<00:32,  2.23it/s] 10%|█         | 8/79 [00:07<00:26,  2.68it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.10it/s] 13%|█▎        | 10/79 [00:08<00:19,  3.46it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.76it/s] 15%|█▌        | 12/79 [00:08<00:16,  4.01it/s] 16%|█▋        | 13/79 [00:08<00:15,  4.16it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.31it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.40it/s] 20%|██        | 16/79 [00:09<00:14,  4.49it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.55it/s] 23%|██▎       | 18/79 [00:09<00:13,  4.51it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.54it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.60it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.64it/s] 28%|██▊       | 22/79 [00:10<00:12,  4.64it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.66it/s] 30%|███       | 24/79 [00:11<00:11,  4.68it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.70it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.68it/s] 34%|███▍      | 27/79 [00:11<00:11,  4.68it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.70it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.69it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.69it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.57it/s] 41%|████      | 32/79 [00:12<00:10,  4.62it/s] 42%|████▏     | 33/79 [00:13<00:10,  4.57it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.61it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.64it/s] 46%|████▌     | 36/79 [00:13<00:09,  4.65it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.65it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.65it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.66it/s] 51%|█████     | 40/79 [00:14<00:08,  4.67it/s] 52%|█████▏    | 41/79 [00:14<00:08,  4.67it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.67it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.67it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.67it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.67it/s] 58%|█████▊    | 46/79 [00:15<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.67it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.67it/s] 63%|██████▎   | 50/79 [00:16<00:06,  4.67it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.67it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.67it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.67it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.67it/s] 70%|██████▉   | 55/79 [00:17<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.67it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.65it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.66it/s] 76%|███████▌  | 60/79 [00:18<00:04,  4.67it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.67it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.64it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.66it/s] 81%|████████  | 64/79 [00:19<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.69it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.66it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.67it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.67it/s] 87%|████████▋ | 69/79 [00:20<00:02,  4.68it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.66it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.67it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.67it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.68it/s] 94%|█████████▎| 74/79 [00:21<00:01,  4.68it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.69it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.66it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.66it/s] 99%|█████████▊| 78/79 [00:22<00:00,  4.66it/s]100%|██████████| 79/79 [00:23<00:00,  3.42it/s]
Validate: [ 0/79]	Time  6.341 ( 6.341)	Loss 8.8359e+00 (8.8359e+00)	Prompt Acc@1  89.84 ( 89.84)
Validate: [10/79]	Time  0.214 ( 0.771)	Loss 1.7203e+01 (1.1262e+01)	Prompt Acc@1  89.84 ( 90.98)
Validate: [20/79]	Time  0.211 ( 0.506)	Loss 1.4812e+01 (1.2027e+01)	Prompt Acc@1  87.50 ( 90.59)
Validate: [30/79]	Time  0.231 ( 0.412)	Loss 1.8141e+01 (1.3190e+01)	Prompt Acc@1  90.62 ( 89.79)
Validate: [40/79]	Time  0.214 ( 0.364)	Loss 1.3992e+01 (1.3184e+01)	Prompt Acc@1  82.81 ( 89.69)
Validate: [50/79]	Time  0.214 ( 0.335)	Loss 1.8188e+01 (1.4101e+01)	Prompt Acc@1  85.16 ( 89.22)
Validate: [60/79]	Time  0.214 ( 0.315)	Loss 1.5812e+01 (1.3937e+01)	Prompt Acc@1  88.28 ( 89.40)
Validate: [70/79]	Time  0.213 ( 0.301)	Loss 1.3570e+01 (1.4011e+01)	Prompt Acc@1  88.28 ( 89.36)
 * Prompt Acc@1 89.230
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.3133, 0.1549, 0.1450, 0.1503, 0.4858],
          [0.8394, 0.5346, 0.5204, 0.2380, 0.2741],
          [0.0974, 0.3113, 0.8091, 0.9583, 0.5126],
          [0.7772, 0.4753, 0.0571, 0.2988, 0.9417],
          [0.8524, 0.9400, 0.1112, 0.9450, 0.7900]],

         [[0.9279, 0.1057, 0.1041, 0.2754, 0.0636],
          [0.6451, 0.5241, 0.4089, 0.9079, 0.6130],
          [0.7988, 0.1569, 0.2187, 0.9125, 0.9567],
          [0.1890, 0.5245, 0.8751, 0.3969, 0.1789],
          [0.3878, 0.4207, 0.8124, 0.0377, 0.5487]],

         [[0.3147, 0.0472, 0.0722, 0.1791, 0.2459],
          [0.0751, 0.3743, 0.9512, 0.1689, 0.6351],
          [0.7969, 0.5812, 0.6121, 0.0797, 0.3443],
          [0.7687, 0.3092, 0.2704, 0.8354, 0.1123],
          [0.6257, 0.1099, 0.2460, 0.0244, 0.2793]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
Running robustness experiment on CIFAR10 with ./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 17)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:33,  6.58s/it]  3%|▎         | 2/79 [00:06<03:38,  2.84s/it]  4%|▍         | 3/79 [00:07<02:04,  1.64s/it]  5%|▌         | 4/79 [00:07<01:20,  1.08s/it]  6%|▋         | 5/79 [00:07<00:56,  1.31it/s]  8%|▊         | 6/79 [00:07<00:42,  1.73it/s]  9%|▉         | 7/79 [00:07<00:32,  2.19it/s] 10%|█         | 8/79 [00:08<00:27,  2.62it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.03it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.41it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.73it/s] 15%|█▌        | 12/79 [00:08<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.19it/s] 18%|█▊        | 14/79 [00:09<00:14,  4.34it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.44it/s] 20%|██        | 16/79 [00:09<00:13,  4.52it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.53it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.59it/s] 24%|██▍       | 19/79 [00:10<00:12,  4.62it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.66it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.65it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.67it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.69it/s] 30%|███       | 24/79 [00:11<00:11,  4.69it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.70it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.71it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.71it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.72it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.73it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.73it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.73it/s] 41%|████      | 32/79 [00:13<00:09,  4.73it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.72it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.70it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.59it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.62it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.64it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.67it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.67it/s] 51%|█████     | 40/79 [00:14<00:08,  4.68it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.67it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.68it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.66it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.67it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.65it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.62it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.62it/s] 61%|██████    | 48/79 [00:16<00:06,  4.64it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.66it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.67it/s] 65%|██████▍   | 51/79 [00:17<00:06,  4.65it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.66it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.66it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.68it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.68it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.69it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.69it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.67it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.68it/s] 81%|████████  | 64/79 [00:20<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.68it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.67it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.68it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.67it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.69it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.67it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.68it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.69it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.69it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.69it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.69it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.69it/s]100%|██████████| 79/79 [00:23<00:00,  3.40it/s]
Validate: [ 0/79]	Time  6.590 ( 6.590)	Loss 1.1703e+01 (1.1703e+01)	Prompt Acc@1  90.62 ( 90.62)
Validate: [10/79]	Time  0.211 ( 0.793)	Loss 1.9484e+01 (1.1332e+01)	Prompt Acc@1  89.06 ( 90.13)
Validate: [20/79]	Time  0.216 ( 0.517)	Loss 1.3945e+01 (1.2061e+01)	Prompt Acc@1  89.84 ( 90.29)
Validate: [30/79]	Time  0.212 ( 0.418)	Loss 1.8984e+01 (1.3193e+01)	Prompt Acc@1  90.62 ( 89.69)
Validate: [40/79]	Time  0.214 ( 0.369)	Loss 1.3742e+01 (1.3274e+01)	Prompt Acc@1  82.03 ( 89.56)
Validate: [50/79]	Time  0.217 ( 0.339)	Loss 1.6234e+01 (1.4052e+01)	Prompt Acc@1  87.50 ( 89.28)
Validate: [60/79]	Time  0.213 ( 0.318)	Loss 1.6000e+01 (1.4112e+01)	Prompt Acc@1  88.28 ( 89.42)
Validate: [70/79]	Time  0.212 ( 0.303)	Loss 1.5453e+01 (1.4313e+01)	Prompt Acc@1  87.50 ( 89.40)
 * Prompt Acc@1 89.220
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar10', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a airplane',
 'A photo of a automobile',
 'A photo of a bird',
 'A photo of a cat',
 'A photo of a deer',
 'A photo of a dog',
 'A photo of a frog',
 'A photo of a horse',
 'A photo of a ship',
 'A photo of a truck']
=> loading checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.9452, 0.0358, 0.5487, 0.6161, 0.1729, 0.8813, 0.5524, 0.0891,
           0.8677, 0.6257],
          [0.0331, 0.4527, 0.3570, 0.8131, 0.6499, 0.2577, 0.5899, 0.6701,
           0.9167, 0.0879],
          [0.5164, 0.7991, 0.6718, 0.5940, 0.3416, 0.8591, 0.2932, 0.4689,
           0.3296, 0.1148],
          [0.4789, 0.1187, 0.4986, 0.3876, 0.9719, 0.8231, 0.3553, 0.7483,
           0.5591, 0.5842],
          [0.8426, 0.0891, 0.4160, 0.9479, 0.4203, 0.6587, 0.4173, 0.7992,
           0.0886, 0.8185],
          [0.4263, 0.3781, 0.9691, 0.7201, 0.7864, 0.6180, 0.6328, 0.9018,
           0.1837, 0.1385],
          [0.3598, 0.0621, 0.5476, 0.6695, 0.4209, 0.0081, 0.2260, 0.3960,
           0.9728, 0.6774],
          [0.2243, 0.9383, 0.9207, 0.0028, 0.8597, 0.5989, 0.2976, 0.7206,
           0.2048, 0.7615],
          [0.7614, 0.7735, 0.4036, 0.7523, 0.2941, 0.9108, 0.1920, 0.1271,
           0.2775, 0.3895],
          [0.9443, 0.2307, 0.4951, 0.4193, 0.8327, 0.0582, 0.5781, 0.2650,
           0.3834, 0.8899]],

         [[0.3672, 0.6479, 0.1794, 0.4941, 0.4298, 0.9327, 0.2569, 0.6848,
           0.6744, 0.7708],
          [0.6973, 0.5137, 0.9034, 0.0873, 0.1299, 0.6044, 0.0173, 0.2725,
           0.0094, 0.3191],
          [0.4035, 0.0939, 0.7052, 0.1116, 0.7221, 0.5149, 0.9014, 0.4376,
           0.7115, 0.5127],
          [0.4115, 0.4445, 0.0514, 0.8604, 0.5127, 0.3679, 0.3428, 0.6407,
           0.1717, 0.9887],
          [0.8762, 0.5164, 0.3805, 0.1601, 0.6669, 0.3138, 0.0229, 0.4619,
           0.8806, 0.8225],
          [0.0841, 0.2588, 0.8395, 0.0142, 0.7265, 0.2328, 0.9609, 0.3684,
           0.6551, 0.6518],
          [0.1376, 0.8307, 0.6716, 0.6949, 0.9204, 0.6912, 0.6444, 0.1933,
           0.2293, 0.9702],
          [0.9747, 0.0454, 0.6987, 0.3538, 0.2772, 0.9882, 0.1308, 0.8077,
           0.2241, 0.4641],
          [0.9979, 0.3623, 0.8555, 0.6498, 0.2748, 0.2876, 0.5298, 0.0224,
           0.8250, 0.0438],
          [0.9397, 0.5139, 0.3408, 0.5696, 0.0925, 0.0871, 0.1032, 0.9561,
           0.8514, 0.7437]],

         [[0.1851, 0.4504, 0.2220, 0.5333, 0.9909, 0.1002, 0.0307, 0.2503,
           0.0343, 0.2571],
          [0.0359, 0.7596, 0.9885, 0.3038, 0.5561, 0.5022, 0.8015, 0.9471,
           0.6926, 0.0260],
          [0.2368, 0.9593, 0.3796, 0.9143, 0.8332, 0.8617, 0.2740, 0.6956,
           0.2497, 0.7979],
          [0.5403, 0.0619, 0.4575, 0.0323, 0.6867, 0.5012, 0.1354, 0.0834,
           0.3871, 0.9206],
          [0.8234, 0.0014, 0.9845, 0.8674, 0.2706, 0.2313, 0.0716, 0.4258,
           0.3506, 0.6131],
          [0.7989, 0.4880, 0.2493, 0.7852, 0.1052, 0.0768, 0.5382, 0.8494,
           0.5052, 0.1969],
          [0.5398, 0.5033, 0.2668, 0.7635, 0.2697, 0.7122, 0.1878, 0.4951,
           0.6680, 0.8764],
          [0.7657, 0.6658, 0.9399, 0.6494, 0.2089, 0.3693, 0.4659, 0.4087,
           0.8019, 0.3135],
          [0.5467, 0.1179, 0.6088, 0.0794, 0.7119, 0.3090, 0.6211, 0.2825,
           0.2147, 0.8167],
          [0.7561, 0.9211, 0.7604, 0.6812, 0.0146, 0.4724, 0.4921, 0.2713,
           0.7430, 0.8294]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_10_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 17)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:41,  6.69s/it]  3%|▎         | 2/79 [00:06<03:41,  2.88s/it]  4%|▍         | 3/79 [00:07<02:06,  1.66s/it]  5%|▌         | 4/79 [00:07<01:21,  1.09s/it]  6%|▋         | 5/79 [00:07<00:57,  1.29it/s]  8%|▊         | 6/79 [00:07<00:42,  1.72it/s]  9%|▉         | 7/79 [00:07<00:33,  2.17it/s] 10%|█         | 8/79 [00:08<00:27,  2.61it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.03it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.41it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.62it/s] 15%|█▌        | 12/79 [00:09<00:17,  3.89it/s] 16%|█▋        | 13/79 [00:09<00:16,  4.10it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.28it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.41it/s] 20%|██        | 16/79 [00:09<00:14,  4.48it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.51it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.57it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.58it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.62it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.65it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.67it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.69it/s] 30%|███       | 24/79 [00:11<00:11,  4.68it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.66it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.68it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.70it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.71it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.72it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.73it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.73it/s] 41%|████      | 32/79 [00:13<00:09,  4.71it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.73it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.71it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.70it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.68it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.68it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.68it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.68it/s] 51%|█████     | 40/79 [00:15<00:08,  4.67it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.67it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.67it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.68it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.68it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.69it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.69it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.69it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.67it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.67it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.69it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.69it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.69it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.68it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.68it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.68it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.68it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.66it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.67it/s] 81%|████████  | 64/79 [00:20<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.67it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.66it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.67it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.68it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.69it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.70it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.69it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.69it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.69it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.67it/s]100%|██████████| 79/79 [00:23<00:00,  3.38it/s]
Validate: [ 0/79]	Time  6.698 ( 6.698)	Loss 1.1250e+01 (1.1250e+01)	Prompt Acc@1  88.28 ( 88.28)
Validate: [10/79]	Time  0.238 ( 0.805)	Loss 1.6328e+01 (1.3224e+01)	Prompt Acc@1  88.28 ( 89.28)
Validate: [20/79]	Time  0.212 ( 0.523)	Loss 1.7812e+01 (1.4286e+01)	Prompt Acc@1  89.06 ( 89.40)
Validate: [30/79]	Time  0.211 ( 0.423)	Loss 1.6641e+01 (1.5037e+01)	Prompt Acc@1  89.84 ( 88.79)
Validate: [40/79]	Time  0.213 ( 0.372)	Loss 1.7203e+01 (1.5284e+01)	Prompt Acc@1  82.81 ( 88.61)
Validate: [50/79]	Time  0.212 ( 0.341)	Loss 1.8938e+01 (1.6260e+01)	Prompt Acc@1  85.94 ( 88.13)
Validate: [60/79]	Time  0.215 ( 0.320)	Loss 1.7000e+01 (1.6098e+01)	Prompt Acc@1  87.50 ( 88.28)
Validate: [70/79]	Time  0.213 ( 0.305)	Loss 1.3328e+01 (1.6191e+01)	Prompt Acc@1  87.50 ( 88.09)
 * Prompt Acc@1 87.960
Running robustness experiment on CIFAR100 with ./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:38,  6.65s/it]  3%|▎         | 2/79 [00:06<03:40,  2.86s/it]  4%|▍         | 3/79 [00:07<02:06,  1.66s/it]  5%|▌         | 4/79 [00:07<01:21,  1.09s/it]  6%|▋         | 5/79 [00:07<00:57,  1.29it/s]  8%|▊         | 6/79 [00:07<00:42,  1.71it/s]  9%|▉         | 7/79 [00:07<00:33,  2.16it/s] 10%|█         | 8/79 [00:08<00:27,  2.61it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.03it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.41it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.72it/s] 15%|█▌        | 12/79 [00:09<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.18it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.32it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.43it/s] 20%|██        | 16/79 [00:09<00:13,  4.52it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.53it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.57it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.61it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.54it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.59it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.62it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.65it/s] 30%|███       | 24/79 [00:11<00:11,  4.67it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.69it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.70it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.71it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.72it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.72it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.71it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.72it/s] 41%|████      | 32/79 [00:13<00:09,  4.73it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.73it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.72it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.70it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.70it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.71it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.69it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.69it/s] 51%|█████     | 40/79 [00:14<00:08,  4.68it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.68it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.66it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.66it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.66it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.65it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.64it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.65it/s] 61%|██████    | 48/79 [00:16<00:06,  4.65it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.66it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.66it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.67it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.67it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.67it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.67it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.67it/s] 71%|███████   | 56/79 [00:18<00:04,  4.65it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.66it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.67it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.67it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.67it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.67it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.67it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.68it/s] 81%|████████  | 64/79 [00:20<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.69it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.69it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.69it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.61it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.63it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.62it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.64it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.64it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.66it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.65it/s]100%|██████████| 79/79 [00:23<00:00,  3.38it/s]
Validate: [ 0/79]	Time  6.657 ( 6.657)	Loss 3.0750e+01 (3.0750e+01)	Prompt Acc@1  76.56 ( 76.56)
Validate: [10/79]	Time  0.214 ( 0.801)	Loss 7.3375e+01 (5.4355e+01)	Prompt Acc@1  54.69 ( 63.85)
Validate: [20/79]	Time  0.213 ( 0.522)	Loss 5.1906e+01 (5.2874e+01)	Prompt Acc@1  63.28 ( 64.40)
Validate: [30/79]	Time  0.211 ( 0.422)	Loss 6.9000e+01 (5.4705e+01)	Prompt Acc@1  57.03 ( 63.81)
Validate: [40/79]	Time  0.214 ( 0.371)	Loss 4.5031e+01 (5.4255e+01)	Prompt Acc@1  69.53 ( 64.41)
Validate: [50/79]	Time  0.214 ( 0.340)	Loss 6.7375e+01 (5.5503e+01)	Prompt Acc@1  62.50 ( 64.00)
Validate: [60/79]	Time  0.215 ( 0.320)	Loss 6.4438e+01 (5.5232e+01)	Prompt Acc@1  61.72 ( 64.18)
Validate: [70/79]	Time  0.213 ( 0.305)	Loss 4.6562e+01 (5.4255e+01)	Prompt Acc@1  62.50 ( 64.25)
 * Prompt Acc@1 64.130
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:17,  6.38s/it]  3%|▎         | 2/79 [00:06<03:31,  2.75s/it]  4%|▍         | 3/79 [00:06<02:01,  1.59s/it]  5%|▌         | 4/79 [00:07<01:18,  1.05s/it]  6%|▋         | 5/79 [00:07<00:55,  1.34it/s]  8%|▊         | 6/79 [00:07<00:41,  1.77it/s]  9%|▉         | 7/79 [00:07<00:32,  2.22it/s] 10%|█         | 8/79 [00:07<00:26,  2.67it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.09it/s] 13%|█▎        | 10/79 [00:08<00:19,  3.46it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.76it/s] 15%|█▌        | 12/79 [00:08<00:16,  4.00it/s] 16%|█▋        | 13/79 [00:08<00:15,  4.20it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.33it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.41it/s] 20%|██        | 16/79 [00:09<00:14,  4.48it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.46it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.47it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.51it/s] 25%|██▌       | 20/79 [00:10<00:13,  4.38it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.46it/s] 28%|██▊       | 22/79 [00:10<00:12,  4.55it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.58it/s] 30%|███       | 24/79 [00:11<00:11,  4.62it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.65it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.68it/s] 34%|███▍      | 27/79 [00:11<00:11,  4.70it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.70it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.71it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.72it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.73it/s] 41%|████      | 32/79 [00:13<00:09,  4.73it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.72it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.71it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.71it/s] 46%|████▌     | 36/79 [00:13<00:09,  4.70it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.67it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.68it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.67it/s] 51%|█████     | 40/79 [00:14<00:08,  4.67it/s] 52%|█████▏    | 41/79 [00:14<00:08,  4.66it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.67it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.67it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.66it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.66it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.67it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.68it/s] 63%|██████▎   | 50/79 [00:16<00:06,  4.69it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.69it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.68it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:17<00:05,  4.67it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.69it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.69it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.70it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.70it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.70it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.70it/s] 81%|████████  | 64/79 [00:19<00:03,  4.70it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.70it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.70it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.70it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.69it/s] 87%|████████▋ | 69/79 [00:20<00:02,  4.67it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.69it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.69it/s] 94%|█████████▎| 74/79 [00:21<00:01,  4.69it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.70it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.70it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.69it/s] 99%|█████████▊| 78/79 [00:22<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.42it/s]
Validate: [ 0/79]	Time  6.385 ( 6.385)	Loss 3.2250e+01 (3.2250e+01)	Prompt Acc@1  78.12 ( 78.12)
Validate: [10/79]	Time  0.214 ( 0.774)	Loss 7.2812e+01 (5.4750e+01)	Prompt Acc@1  55.47 ( 64.06)
Validate: [20/79]	Time  0.214 ( 0.510)	Loss 5.5031e+01 (5.3296e+01)	Prompt Acc@1  64.06 ( 64.62)
Validate: [30/79]	Time  0.211 ( 0.414)	Loss 6.9500e+01 (5.5024e+01)	Prompt Acc@1  57.03 ( 63.99)
Validate: [40/79]	Time  0.216 ( 0.365)	Loss 4.3125e+01 (5.4512e+01)	Prompt Acc@1  71.09 ( 64.56)
Validate: [50/79]	Time  0.214 ( 0.335)	Loss 6.6812e+01 (5.5694e+01)	Prompt Acc@1  61.72 ( 64.22)
Validate: [60/79]	Time  0.213 ( 0.315)	Loss 6.4250e+01 (5.5499e+01)	Prompt Acc@1  61.72 ( 64.40)
Validate: [70/79]	Time  0.214 ( 0.301)	Loss 4.6281e+01 (5.4471e+01)	Prompt Acc@1  62.50 ( 64.56)
 * Prompt Acc@1 64.440
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2277]],

         [[0.8877]],

         [[0.3383]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
Running robustness experiment on CIFAR100 with ./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:26,  6.49s/it]  3%|▎         | 2/79 [00:06<03:35,  2.80s/it]  4%|▍         | 3/79 [00:06<02:02,  1.62s/it]  5%|▌         | 4/79 [00:07<01:20,  1.07s/it]  6%|▋         | 5/79 [00:07<00:56,  1.32it/s]  8%|▊         | 6/79 [00:07<00:41,  1.75it/s]  9%|▉         | 7/79 [00:07<00:32,  2.20it/s] 10%|█         | 8/79 [00:07<00:26,  2.65it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.07it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.43it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.73it/s] 15%|█▌        | 12/79 [00:08<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.18it/s] 18%|█▊        | 14/79 [00:09<00:14,  4.34it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.45it/s] 20%|██        | 16/79 [00:09<00:13,  4.53it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.58it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.60it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.61it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.58it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.61it/s] 28%|██▊       | 22/79 [00:10<00:12,  4.65it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.68it/s] 30%|███       | 24/79 [00:11<00:11,  4.68it/s] 32%|███▏      | 25/79 [00:11<00:12,  4.39it/s] 33%|███▎      | 26/79 [00:11<00:12,  4.21it/s] 34%|███▍      | 27/79 [00:12<00:12,  4.33it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.45it/s] 37%|███▋      | 29/79 [00:12<00:11,  4.53it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.58it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.62it/s] 41%|████      | 32/79 [00:13<00:10,  4.66it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.68it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.67it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.66it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.66it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.63it/s] 48%|████▊     | 38/79 [00:14<00:09,  4.55it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.57it/s] 51%|█████     | 40/79 [00:14<00:08,  4.61it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.63it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.63it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.63it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.64it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.65it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.66it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.68it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.68it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.69it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.68it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.69it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.68it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.68it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.69it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.68it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.68it/s] 81%|████████  | 64/79 [00:20<00:03,  4.69it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.69it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.68it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.69it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.69it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.66it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.64it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.65it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.66it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.67it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.67it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.67it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.39it/s]
Validate: [ 0/79]	Time  6.496 ( 6.496)	Loss 3.9750e+01 (3.9750e+01)	Prompt Acc@1  73.44 ( 73.44)
Validate: [10/79]	Time  0.213 ( 0.785)	Loss 6.7000e+01 (5.6548e+01)	Prompt Acc@1  56.25 ( 64.77)
Validate: [20/79]	Time  0.213 ( 0.513)	Loss 6.6125e+01 (5.6911e+01)	Prompt Acc@1  64.06 ( 65.48)
Validate: [30/79]	Time  0.212 ( 0.419)	Loss 7.7250e+01 (5.9499e+01)	Prompt Acc@1  65.62 ( 65.02)
Validate: [40/79]	Time  0.214 ( 0.370)	Loss 4.9594e+01 (5.9030e+01)	Prompt Acc@1  70.31 ( 65.47)
Validate: [50/79]	Time  0.213 ( 0.339)	Loss 6.8250e+01 (5.9686e+01)	Prompt Acc@1  66.41 ( 65.41)
Validate: [60/79]	Time  0.212 ( 0.318)	Loss 8.3000e+01 (5.9424e+01)	Prompt Acc@1  59.38 ( 65.46)
Validate: [70/79]	Time  0.217 ( 0.304)	Loss 4.8531e+01 (5.8441e+01)	Prompt Acc@1  64.84 ( 65.57)
 * Prompt Acc@1 65.560
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7455, 0.7496, 0.8182, 0.6404, 0.5800, 0.5235, 0.1082, 0.7712,
           0.6070, 0.6946],
          [0.6065, 0.6509, 0.7363, 0.4073, 0.2438, 0.3088, 0.6864, 0.8412,
           0.9093, 0.0537],
          [0.2695, 0.2061, 0.0878, 0.1619, 0.7221, 0.5444, 0.2056, 0.9054,
           0.5251, 0.3736],
          [0.5106, 0.3145, 0.7087, 0.1385, 0.7522, 0.0462, 0.5995, 0.5390,
           0.0940, 0.8535],
          [0.4309, 0.1230, 0.1374, 0.9023, 0.9698, 0.0724, 0.1745, 0.5316,
           0.0458, 0.3984],
          [0.6231, 0.6072, 0.1867, 0.3708, 0.0943, 0.2642, 0.6122, 0.5529,
           0.7540, 0.1912],
          [0.1932, 0.0508, 0.8579, 0.7532, 0.3805, 0.8344, 0.3637, 0.2615,
           0.7454, 0.0919],
          [0.1498, 0.7566, 0.7420, 0.2438, 0.6819, 0.1910, 0.4924, 0.7412,
           0.8707, 0.8711],
          [0.9966, 0.6484, 0.4708, 0.1359, 0.1212, 0.1383, 0.9061, 0.8260,
           0.2329, 0.5677],
          [0.9077, 0.4786, 0.6629, 0.0953, 0.2592, 0.2027, 0.8775, 0.6329,
           0.5994, 0.6271]],

         [[0.4009, 0.8600, 0.4726, 0.6356, 0.4242, 0.7747, 0.0131, 0.8453,
           0.0664, 0.8062],
          [0.9789, 0.5187, 0.8120, 0.8518, 0.9731, 0.7570, 0.4331, 0.1478,
           0.5634, 0.1606],
          [0.2817, 0.4691, 0.5928, 0.8918, 0.9177, 0.1490, 0.7090, 0.8721,
           0.3031, 0.2935],
          [0.0880, 0.4447, 0.6947, 0.4581, 0.7783, 0.8611, 0.9343, 0.9343,
           0.5187, 0.5424],
          [0.9754, 0.4049, 0.8910, 0.0349, 0.4498, 0.1072, 0.5694, 0.8083,
           0.3209, 0.5607],
          [0.6868, 0.4401, 0.5870, 0.8122, 0.5841, 0.9614, 0.5249, 0.0617,
           0.2706, 0.1718],
          [0.6944, 0.8922, 0.1198, 0.9866, 0.4000, 0.4124, 0.0753, 0.8536,
           0.5519, 0.1704],
          [0.1995, 0.6353, 0.1296, 0.3928, 0.5648, 0.0922, 0.3544, 0.9845,
           0.0813, 0.3455],
          [0.3333, 0.8673, 0.9380, 0.7422, 0.8199, 0.6772, 0.8197, 0.5484,
           0.2024, 0.1645],
          [0.8737, 0.4687, 0.7878, 0.4892, 0.4632, 0.6428, 0.4104, 0.6306,
           0.0941, 0.9291]],

         [[0.1762, 0.8679, 0.1807, 0.0901, 0.7387, 0.5699, 0.7557, 0.2696,
           0.9886, 0.9535],
          [0.8004, 0.5712, 0.6416, 0.9061, 0.9078, 0.3933, 0.7692, 0.2461,
           0.3878, 0.5085],
          [0.0176, 0.0854, 0.4933, 0.5510, 0.8199, 0.8930, 0.6248, 0.1702,
           0.8370, 0.5729],
          [0.0323, 0.3184, 0.5144, 0.7629, 0.8686, 0.0412, 0.1064, 0.3078,
           0.4794, 0.1899],
          [0.0103, 0.8446, 0.7952, 0.0871, 0.1941, 0.6595, 0.5053, 0.0036,
           0.2367, 0.3814],
          [0.3418, 0.6897, 0.4974, 0.7450, 0.6968, 0.9761, 0.6832, 0.2816,
           0.8308, 0.3791],
          [0.9220, 0.7468, 0.9778, 0.4317, 0.6892, 0.5153, 0.8030, 0.1631,
           0.4363, 0.0867],
          [0.2201, 0.2872, 0.8118, 0.3774, 0.7005, 0.8836, 0.2387, 0.4411,
           0.0633, 0.1999],
          [0.1656, 0.4581, 0.1118, 0.1362, 0.1952, 0.2895, 0.3400, 0.5251,
           0.8571, 0.2829],
          [0.9595, 0.4471, 0.0965, 0.9619, 0.3965, 0.9089, 0.8270, 0.8876,
           0.3363, 0.4614]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:27,  6.51s/it]  3%|▎         | 2/79 [00:06<03:35,  2.80s/it]  4%|▍         | 3/79 [00:06<02:03,  1.63s/it]  5%|▌         | 4/79 [00:07<01:20,  1.07s/it]  6%|▋         | 5/79 [00:07<00:56,  1.31it/s]  8%|▊         | 6/79 [00:07<00:41,  1.74it/s]  9%|▉         | 7/79 [00:07<00:32,  2.19it/s] 10%|█         | 8/79 [00:08<00:27,  2.63it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.05it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.41it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.73it/s] 15%|█▌        | 12/79 [00:08<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.14it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.30it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.41it/s] 20%|██        | 16/79 [00:09<00:14,  4.48it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.53it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.55it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.52it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.57it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.62it/s] 28%|██▊       | 22/79 [00:11<00:13,  4.32it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.42it/s] 30%|███       | 24/79 [00:11<00:12,  4.50it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.56it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.60it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.63it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.56it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.60it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.62it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.65it/s] 41%|████      | 32/79 [00:13<00:10,  4.66it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.68it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.67it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.68it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.68it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.67it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.67it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.67it/s] 51%|█████     | 40/79 [00:14<00:08,  4.67it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.66it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.65it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.66it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.67it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.68it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.67it/s] 61%|██████    | 48/79 [00:16<00:06,  4.67it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.66it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.66it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.67it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.66it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.67it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.67it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.67it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.67it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.67it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.68it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.65it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.62it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.64it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.66it/s] 81%|████████  | 64/79 [00:20<00:03,  4.65it/s] 82%|████████▏ | 65/79 [00:20<00:03,  4.64it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.67it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.68it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.68it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.69it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.69it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.70it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.70it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.70it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.67it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.66it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.66it/s]100%|██████████| 79/79 [00:23<00:00,  3.39it/s]
Validate: [ 0/79]	Time  6.516 ( 6.516)	Loss 4.1438e+01 (4.1438e+01)	Prompt Acc@1  71.88 ( 71.88)
Validate: [10/79]	Time  0.212 ( 0.788)	Loss 7.6500e+01 (6.1378e+01)	Prompt Acc@1  54.69 ( 62.78)
Validate: [20/79]	Time  0.211 ( 0.515)	Loss 7.2625e+01 (6.1043e+01)	Prompt Acc@1  62.50 ( 63.76)
Validate: [30/79]	Time  0.212 ( 0.420)	Loss 7.6625e+01 (6.2105e+01)	Prompt Acc@1  60.94 ( 63.71)
Validate: [40/79]	Time  0.215 ( 0.370)	Loss 5.1312e+01 (6.2033e+01)	Prompt Acc@1  70.31 ( 64.02)
Validate: [50/79]	Time  0.214 ( 0.339)	Loss 7.5875e+01 (6.3042e+01)	Prompt Acc@1  60.94 ( 63.96)
Validate: [60/79]	Time  0.220 ( 0.319)	Loss 9.2812e+01 (6.3054e+01)	Prompt Acc@1  57.03 ( 63.90)
Validate: [70/79]	Time  0.212 ( 0.304)	Loss 5.0219e+01 (6.2316e+01)	Prompt Acc@1  61.72 ( 63.99)
 * Prompt Acc@1 64.020
Running robustness experiment on CIFAR100 with ./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:16,  6.36s/it]  3%|▎         | 2/79 [00:06<03:31,  2.75s/it]  4%|▍         | 3/79 [00:06<02:01,  1.59s/it]  5%|▌         | 4/79 [00:07<01:18,  1.05s/it]  6%|▋         | 5/79 [00:07<00:55,  1.34it/s]  8%|▊         | 6/79 [00:07<00:42,  1.71it/s]  9%|▉         | 7/79 [00:07<00:33,  2.16it/s] 10%|█         | 8/79 [00:07<00:27,  2.58it/s] 11%|█▏        | 9/79 [00:08<00:23,  2.97it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.29it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.62it/s] 15%|█▌        | 12/79 [00:08<00:17,  3.88it/s] 16%|█▋        | 13/79 [00:09<00:16,  4.09it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.24it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.36it/s] 20%|██        | 16/79 [00:09<00:15,  4.13it/s] 22%|██▏       | 17/79 [00:09<00:14,  4.27it/s] 23%|██▎       | 18/79 [00:10<00:14,  4.34it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.43it/s] 25%|██▌       | 20/79 [00:10<00:13,  4.49it/s] 27%|██▋       | 21/79 [00:10<00:13,  4.34it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.39it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.49it/s] 30%|███       | 24/79 [00:11<00:12,  4.56it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.58it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.62it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.66it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.66it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.68it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.68it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.69it/s] 41%|████      | 32/79 [00:13<00:10,  4.69it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.71it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.70it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.69it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.68it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.70it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.70it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.70it/s] 51%|█████     | 40/79 [00:14<00:08,  4.70it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.70it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.70it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.70it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.70it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.67it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.67it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.67it/s] 61%|██████    | 48/79 [00:16<00:06,  4.69it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.69it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.68it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.69it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.69it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.70it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.71it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.69it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.70it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.70it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.69it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.69it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.69it/s] 81%|████████  | 64/79 [00:20<00:03,  4.69it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.70it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.70it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.70it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.70it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.70it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.70it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.70it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.69it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.70it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.69it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.69it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.40it/s]
Validate: [ 0/79]	Time  6.368 ( 6.368)	Loss 3.1891e+01 (3.1891e+01)	Prompt Acc@1  78.91 ( 78.91)
Validate: [10/79]	Time  0.214 ( 0.783)	Loss 7.1625e+01 (5.4129e+01)	Prompt Acc@1  55.47 ( 63.64)
Validate: [20/79]	Time  0.248 ( 0.517)	Loss 5.3906e+01 (5.3324e+01)	Prompt Acc@1  62.50 ( 64.88)
Validate: [30/79]	Time  0.212 ( 0.419)	Loss 7.2938e+01 (5.5559e+01)	Prompt Acc@1  63.28 ( 64.54)
Validate: [40/79]	Time  0.213 ( 0.369)	Loss 4.4750e+01 (5.5085e+01)	Prompt Acc@1  70.31 ( 64.92)
Validate: [50/79]	Time  0.212 ( 0.338)	Loss 6.9625e+01 (5.6171e+01)	Prompt Acc@1  62.50 ( 64.78)
Validate: [60/79]	Time  0.213 ( 0.318)	Loss 7.0688e+01 (5.6097e+01)	Prompt Acc@1  63.28 ( 64.96)
Validate: [70/79]	Time  0.213 ( 0.303)	Loss 4.6250e+01 (5.4972e+01)	Prompt Acc@1  63.28 ( 65.03)
 * Prompt Acc@1 64.930
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
=> loaded checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 1)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:52,  6.82s/it]  3%|▎         | 2/79 [00:07<03:45,  2.93s/it]  4%|▍         | 3/79 [00:07<02:08,  1.69s/it]  5%|▌         | 4/79 [00:07<01:22,  1.11s/it]  6%|▋         | 5/79 [00:07<00:57,  1.28it/s]  8%|▊         | 6/79 [00:07<00:43,  1.70it/s]  9%|▉         | 7/79 [00:08<00:33,  2.15it/s] 10%|█         | 8/79 [00:08<00:27,  2.59it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.02it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.40it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.72it/s] 15%|█▌        | 12/79 [00:09<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.20it/s] 18%|█▊        | 14/79 [00:09<00:14,  4.34it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.46it/s] 20%|██        | 16/79 [00:10<00:14,  4.46it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.44it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.52it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.57it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.63it/s] 27%|██▋       | 21/79 [00:11<00:12,  4.64it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.67it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.68it/s] 30%|███       | 24/79 [00:11<00:11,  4.69it/s] 32%|███▏      | 25/79 [00:11<00:12,  4.49it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.54it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.38it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.47it/s] 37%|███▋      | 29/79 [00:12<00:11,  4.54it/s] 38%|███▊      | 30/79 [00:13<00:10,  4.59it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.64it/s] 41%|████      | 32/79 [00:13<00:10,  4.41it/s] 42%|████▏     | 33/79 [00:13<00:10,  4.47it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.53it/s] 44%|████▍     | 35/79 [00:14<00:09,  4.56it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.59it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.58it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.61it/s] 49%|████▉     | 39/79 [00:15<00:08,  4.62it/s] 51%|█████     | 40/79 [00:15<00:08,  4.64it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.65it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.67it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.53it/s] 56%|█████▌    | 44/79 [00:16<00:08,  4.32it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.43it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.50it/s] 59%|█████▉    | 47/79 [00:16<00:07,  4.56it/s] 61%|██████    | 48/79 [00:17<00:06,  4.60it/s] 62%|██████▏   | 49/79 [00:17<00:06,  4.62it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.62it/s] 65%|██████▍   | 51/79 [00:17<00:06,  4.63it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.62it/s] 67%|██████▋   | 53/79 [00:18<00:05,  4.64it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.63it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.64it/s] 71%|███████   | 56/79 [00:18<00:04,  4.66it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.67it/s] 73%|███████▎  | 58/79 [00:19<00:04,  4.67it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.63it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.66it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.66it/s] 78%|███████▊  | 62/79 [00:20<00:03,  4.66it/s] 80%|███████▉  | 63/79 [00:20<00:03,  4.67it/s] 81%|████████  | 64/79 [00:20<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.68it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:21<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.68it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.69it/s] 91%|█████████ | 72/79 [00:22<00:01,  4.70it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.68it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.65it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.66it/s] 96%|█████████▌| 76/79 [00:23<00:00,  4.66it/s] 97%|█████████▋| 77/79 [00:23<00:00,  4.67it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.65it/s]100%|██████████| 79/79 [00:23<00:00,  3.33it/s]
Validate: [ 0/79]	Time  6.827 ( 6.827)	Loss 3.8906e+01 (3.8906e+01)	Prompt Acc@1  73.44 ( 73.44)
Validate: [10/79]	Time  0.211 ( 0.813)	Loss 7.5250e+01 (5.7205e+01)	Prompt Acc@1  57.81 ( 63.99)
Validate: [20/79]	Time  0.214 ( 0.528)	Loss 6.3594e+01 (5.6062e+01)	Prompt Acc@1  62.50 ( 64.77)
Validate: [30/79]	Time  0.211 ( 0.428)	Loss 7.5000e+01 (5.7353e+01)	Prompt Acc@1  60.16 ( 64.57)
Validate: [40/79]	Time  0.214 ( 0.377)	Loss 4.5750e+01 (5.7127e+01)	Prompt Acc@1  71.88 ( 64.81)
Validate: [50/79]	Time  0.216 ( 0.346)	Loss 6.5125e+01 (5.8150e+01)	Prompt Acc@1  66.41 ( 64.77)
Validate: [60/79]	Time  0.214 ( 0.325)	Loss 7.4125e+01 (5.7876e+01)	Prompt Acc@1  63.28 ( 64.89)
Validate: [70/79]	Time  0.213 ( 0.309)	Loss 4.4312e+01 (5.6808e+01)	Prompt Acc@1  63.28 ( 64.91)
 * Prompt Acc@1 64.820
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[3.2493e-01, 2.8545e-04, 5.8493e-01, 8.1695e-02, 2.0745e-01],
          [4.7969e-01, 5.5490e-01, 9.8646e-01, 3.6069e-01, 2.1315e-01],
          [9.8256e-01, 8.7326e-01, 4.0607e-01, 7.5715e-01, 6.9095e-01],
          [8.5614e-01, 8.2073e-01, 2.5829e-01, 4.2788e-01, 4.5730e-01],
          [1.7710e-01, 8.5970e-01, 8.2088e-01, 5.2517e-01, 8.1476e-01]],

         [[5.3804e-01, 1.6488e-01, 6.7914e-01, 2.5480e-01, 6.1007e-01],
          [2.7135e-01, 2.5193e-01, 6.4870e-01, 2.1304e-01, 7.2469e-01],
          [7.3700e-01, 7.7945e-01, 7.0015e-02, 7.1916e-01, 4.7772e-01],
          [9.8154e-01, 6.9678e-03, 7.8548e-01, 3.5371e-01, 8.0123e-01],
          [5.7491e-01, 3.9042e-01, 7.1275e-03, 6.3053e-01, 6.3411e-01]],

         [[8.5331e-01, 5.2852e-01, 2.3886e-02, 2.1514e-01, 3.7085e-01],
          [4.1775e-01, 9.9680e-01, 3.0265e-01, 2.9778e-02, 8.8646e-01],
          [3.7257e-01, 9.5972e-01, 5.5807e-01, 8.5002e-01, 3.3919e-01],
          [4.0043e-01, 9.7792e-01, 2.4440e-01, 9.4391e-01, 7.4632e-01],
          [9.1551e-01, 4.9751e-01, 7.7903e-01, 2.2947e-01, 5.6428e-04]]]],
       device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
Running robustness experiment on CIFAR100 with ./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 18)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:45,  6.74s/it]  3%|▎         | 2/79 [00:06<03:43,  2.90s/it]  4%|▍         | 3/79 [00:07<02:07,  1.67s/it]  5%|▌         | 4/79 [00:07<01:22,  1.09s/it]  6%|▋         | 5/79 [00:07<00:57,  1.29it/s]  8%|▊         | 6/79 [00:07<00:42,  1.71it/s]  9%|▉         | 7/79 [00:08<00:33,  2.15it/s] 10%|█         | 8/79 [00:08<00:27,  2.61it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.03it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.41it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.73it/s] 15%|█▌        | 12/79 [00:09<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.17it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.32it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.43it/s] 20%|██        | 16/79 [00:09<00:14,  4.50it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.47it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.55it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.60it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.63it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.66it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.69it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.68it/s] 30%|███       | 24/79 [00:11<00:11,  4.70it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.71it/s] 33%|███▎      | 26/79 [00:12<00:11,  4.72it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.71it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.71it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.69it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.71it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.71it/s] 41%|████      | 32/79 [00:13<00:09,  4.72it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.71it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.71it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.69it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.68it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.68it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.68it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.68it/s] 51%|█████     | 40/79 [00:15<00:08,  4.67it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.68it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.69it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.66it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.66it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.67it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.68it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.67it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.69it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.69it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.67it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.69it/s] 68%|██████▊   | 54/79 [00:18<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.67it/s] 71%|███████   | 56/79 [00:18<00:04,  4.65it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.67it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.66it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.63it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.64it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.66it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.67it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.67it/s] 81%|████████  | 64/79 [00:20<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.68it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:21<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.67it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.65it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.64it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.65it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.66it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.66it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.66it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.67it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.37it/s]
Validate: [ 0/79]	Time  6.744 ( 6.744)	Loss 4.0000e+01 (4.0000e+01)	Prompt Acc@1  73.44 ( 73.44)
Validate: [10/79]	Time  0.210 ( 0.806)	Loss 6.7938e+01 (5.7247e+01)	Prompt Acc@1  57.81 ( 64.56)
Validate: [20/79]	Time  0.211 ( 0.524)	Loss 6.6688e+01 (5.7424e+01)	Prompt Acc@1  64.06 ( 65.51)
Validate: [30/79]	Time  0.212 ( 0.423)	Loss 7.8062e+01 (5.9943e+01)	Prompt Acc@1  65.62 ( 65.05)
Validate: [40/79]	Time  0.213 ( 0.372)	Loss 4.9375e+01 (5.9376e+01)	Prompt Acc@1  70.31 ( 65.55)
Validate: [50/79]	Time  0.215 ( 0.341)	Loss 6.9562e+01 (6.0012e+01)	Prompt Acc@1  63.28 ( 65.49)
Validate: [60/79]	Time  0.213 ( 0.320)	Loss 8.2750e+01 (5.9745e+01)	Prompt Acc@1  60.16 ( 65.57)
Validate: [70/79]	Time  0.218 ( 0.305)	Loss 4.8750e+01 (5.8792e+01)	Prompt Acc@1  64.06 ( 65.61)
 * Prompt Acc@1 65.580
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 10, 10]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.7465, 0.2457, 0.5601, 0.8966, 0.3488, 0.4767, 0.2124, 0.5900,
           0.2327, 0.8841],
          [0.4610, 0.6331, 0.2780, 0.5383, 0.5231, 0.8623, 0.7408, 0.3150,
           0.1444, 0.6670],
          [0.9932, 0.9533, 0.8685, 0.0233, 0.8112, 0.8551, 0.3900, 0.5928,
           0.8016, 0.9707],
          [0.9333, 0.4126, 0.2183, 0.9145, 0.5182, 0.9862, 0.7296, 0.4363,
           0.5102, 0.3403],
          [0.0247, 0.0441, 0.3632, 0.9488, 0.8308, 0.7186, 0.5225, 0.6500,
           0.5385, 0.4598],
          [0.5835, 0.1930, 0.1719, 0.6116, 0.5311, 0.9116, 0.6609, 0.5854,
           0.7972, 0.8864],
          [0.8027, 0.1535, 0.0395, 0.0807, 0.8256, 0.7016, 0.7431, 0.8174,
           0.3726, 0.7512],
          [0.6739, 0.9649, 0.0817, 0.3136, 0.3527, 0.5909, 0.2951, 0.2790,
           0.3001, 0.9551],
          [0.0693, 0.8384, 0.6399, 0.4614, 0.4211, 0.0252, 0.7919, 0.5611,
           0.7742, 0.8843],
          [0.9615, 0.9169, 0.6795, 0.2369, 0.6552, 0.3922, 0.6039, 0.8089,
           0.3199, 0.8598]],

         [[0.7860, 0.5565, 0.4378, 0.3091, 0.0976, 0.0201, 0.9386, 0.8906,
           0.4978, 0.8112],
          [0.0740, 0.6716, 0.2002, 0.8477, 0.7013, 0.6916, 0.5430, 0.6379,
           0.7362, 0.7554],
          [0.2806, 0.9686, 0.7648, 0.3842, 0.4572, 0.7389, 0.3845, 0.0687,
           0.7708, 0.4007],
          [0.6012, 0.8532, 0.6784, 0.0013, 0.7982, 0.8765, 0.8661, 0.2045,
           0.7035, 0.2848],
          [0.8494, 0.8900, 0.1199, 0.9836, 0.5751, 0.0013, 0.1168, 0.4217,
           0.3704, 0.4542],
          [0.1751, 0.4901, 0.9891, 0.4974, 0.5903, 0.6878, 0.9851, 0.9488,
           0.6014, 0.3551],
          [0.1840, 0.8886, 0.7772, 0.8172, 0.9213, 0.6272, 0.9403, 0.3394,
           0.6307, 0.7958],
          [0.5327, 0.0588, 0.9193, 0.9308, 0.5716, 0.6943, 0.5299, 0.8769,
           0.4890, 0.1743],
          [0.2573, 0.8743, 0.2953, 0.6178, 0.2827, 0.4021, 0.4087, 0.8133,
           0.3254, 0.8229],
          [0.5058, 0.0410, 0.2415, 0.7507, 0.3218, 0.9339, 0.6621, 0.5366,
           0.3173, 0.4193]],

         [[0.0120, 0.0358, 0.9390, 0.7035, 0.5847, 0.7481, 0.0352, 0.6294,
           0.5652, 0.4083],
          [0.8265, 0.6479, 0.6911, 0.0609, 0.1373, 0.6079, 0.2136, 0.0031,
           0.3350, 0.5560],
          [0.3929, 0.5621, 0.3637, 0.0108, 0.8464, 0.4298, 0.3319, 0.9388,
           0.3349, 0.2606],
          [0.4008, 0.2724, 0.4405, 0.3307, 0.4505, 0.2904, 0.7630, 0.8675,
           0.0592, 0.0493],
          [0.8674, 0.4045, 0.9570, 0.6893, 0.4343, 0.4330, 0.8149, 0.2591,
           0.5170, 0.1556],
          [0.3595, 0.5858, 0.8023, 0.9672, 0.1932, 0.3060, 0.0376, 0.1052,
           0.7385, 0.0647],
          [0.3349, 0.0507, 0.4777, 0.9608, 0.7163, 0.6585, 0.5773, 0.2400,
           0.0365, 0.8834],
          [0.4705, 0.5132, 0.0367, 0.6866, 0.6391, 0.9097, 0.3508, 0.2161,
           0.9762, 0.9416],
          [0.5111, 0.6471, 0.8411, 0.4203, 0.5250, 0.3147, 0.9442, 0.2454,
           0.6134, 0.6779],
          [0.5592, 0.5679, 0.1743, 0.2275, 0.5579, 0.7682, 0.7962, 0.1046,
           0.3638, 0.5722]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 18)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  300
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:28,  6.52s/it]  3%|▎         | 2/79 [00:06<03:36,  2.82s/it]  4%|▍         | 3/79 [00:06<02:03,  1.63s/it]  5%|▌         | 4/79 [00:07<01:20,  1.07s/it]  6%|▋         | 5/79 [00:07<00:56,  1.32it/s]  8%|▊         | 6/79 [00:07<00:42,  1.72it/s]  9%|▉         | 7/79 [00:07<00:33,  2.17it/s] 10%|█         | 8/79 [00:08<00:27,  2.61it/s] 11%|█▏        | 9/79 [00:08<00:23,  3.04it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.42it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.74it/s] 15%|█▌        | 12/79 [00:08<00:16,  3.99it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.16it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.30it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.42it/s] 20%|██        | 16/79 [00:09<00:13,  4.52it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.50it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.52it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.59it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.56it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.62it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.58it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.62it/s] 30%|███       | 24/79 [00:11<00:11,  4.64it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.66it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.69it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.69it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.70it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.70it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.72it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.68it/s] 41%|████      | 32/79 [00:13<00:10,  4.70it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.67it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.65it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.56it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.58it/s] 47%|████▋     | 37/79 [00:14<00:09,  4.62it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.63it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.65it/s] 51%|█████     | 40/79 [00:14<00:08,  4.59it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.62it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.64it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.66it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.67it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.68it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.68it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.69it/s] 61%|██████    | 48/79 [00:16<00:06,  4.70it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.71it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.63it/s] 65%|██████▍   | 51/79 [00:17<00:06,  4.65it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.65it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.67it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.68it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.68it/s] 71%|███████   | 56/79 [00:18<00:04,  4.67it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.67it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.67it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.68it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.68it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.68it/s] 81%|████████  | 64/79 [00:20<00:03,  4.69it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.68it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.70it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.71it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.70it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.70it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.70it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.70it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.70it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.70it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.70it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.70it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.39it/s]
Validate: [ 0/79]	Time  6.528 ( 6.528)	Loss 4.2719e+01 (4.2719e+01)	Prompt Acc@1  70.31 ( 70.31)
Validate: [10/79]	Time  0.211 ( 0.789)	Loss 7.8188e+01 (6.1918e+01)	Prompt Acc@1  54.69 ( 62.57)
Validate: [20/79]	Time  0.209 ( 0.516)	Loss 7.2625e+01 (6.1772e+01)	Prompt Acc@1  63.28 ( 63.69)
Validate: [30/79]	Time  0.217 ( 0.418)	Loss 7.8125e+01 (6.2717e+01)	Prompt Acc@1  60.16 ( 63.58)
Validate: [40/79]	Time  0.213 ( 0.369)	Loss 5.3719e+01 (6.2629e+01)	Prompt Acc@1  70.31 ( 63.87)
Validate: [50/79]	Time  0.214 ( 0.339)	Loss 7.4562e+01 (6.3453e+01)	Prompt Acc@1  60.94 ( 63.80)
Validate: [60/79]	Time  0.214 ( 0.318)	Loss 9.3250e+01 (6.3453e+01)	Prompt Acc@1  56.25 ( 63.74)
Validate: [70/79]	Time  0.213 ( 0.303)	Loss 4.9094e+01 (6.2629e+01)	Prompt Acc@1  60.94 ( 63.72)
 * Prompt Acc@1 63.760
Running robustness experiment on CIFAR100 with ./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 6)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:21,  6.43s/it]  3%|▎         | 2/79 [00:06<03:34,  2.78s/it]  4%|▍         | 3/79 [00:06<02:02,  1.61s/it]  5%|▌         | 4/79 [00:07<01:19,  1.06s/it]  6%|▋         | 5/79 [00:07<00:55,  1.33it/s]  8%|▊         | 6/79 [00:07<00:41,  1.76it/s]  9%|▉         | 7/79 [00:07<00:32,  2.21it/s] 10%|█         | 8/79 [00:07<00:26,  2.67it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.08it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.45it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.76it/s] 15%|█▌        | 12/79 [00:08<00:16,  4.00it/s] 16%|█▋        | 13/79 [00:08<00:15,  4.20it/s] 18%|█▊        | 14/79 [00:09<00:14,  4.35it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.46it/s] 20%|██        | 16/79 [00:09<00:13,  4.52it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.54it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.55it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.60it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.62it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.65it/s] 28%|██▊       | 22/79 [00:10<00:12,  4.65it/s] 29%|██▉       | 23/79 [00:11<00:12,  4.53it/s] 30%|███       | 24/79 [00:11<00:12,  4.45it/s] 32%|███▏      | 25/79 [00:11<00:12,  4.24it/s] 33%|███▎      | 26/79 [00:11<00:12,  4.36it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.38it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.49it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.55it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.60it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.64it/s] 41%|████      | 32/79 [00:13<00:10,  4.66it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.66it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.68it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.68it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.69it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.68it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.67it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.69it/s] 51%|█████     | 40/79 [00:14<00:08,  4.68it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.49it/s] 53%|█████▎    | 42/79 [00:15<00:08,  4.54it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.50it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.54it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.59it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.58it/s] 59%|█████▉    | 47/79 [00:16<00:07,  4.55it/s] 61%|██████    | 48/79 [00:16<00:06,  4.61it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.64it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.66it/s] 65%|██████▍   | 51/79 [00:17<00:06,  4.66it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.66it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.67it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.67it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.68it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.69it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.68it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.68it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.68it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.69it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.69it/s] 81%|████████  | 64/79 [00:20<00:03,  4.69it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.68it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.70it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.70it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.70it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.69it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.69it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.70it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.70it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.70it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.70it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.68it/s]100%|██████████| 79/79 [00:23<00:00,  3.40it/s]
Validate: [ 0/79]	Time  6.438 ( 6.438)	Loss 3.2156e+01 (3.2156e+01)	Prompt Acc@1  78.91 ( 78.91)
Validate: [10/79]	Time  0.211 ( 0.779)	Loss 7.1125e+01 (5.4136e+01)	Prompt Acc@1  57.03 ( 63.99)
Validate: [20/79]	Time  0.211 ( 0.510)	Loss 5.4969e+01 (5.3470e+01)	Prompt Acc@1  63.28 ( 65.18)
Validate: [30/79]	Time  0.211 ( 0.417)	Loss 7.2312e+01 (5.5701e+01)	Prompt Acc@1  64.84 ( 64.94)
Validate: [40/79]	Time  0.244 ( 0.368)	Loss 4.4062e+01 (5.5219e+01)	Prompt Acc@1  70.31 ( 65.26)
Validate: [50/79]	Time  0.214 ( 0.339)	Loss 6.9500e+01 (5.6308e+01)	Prompt Acc@1  62.50 ( 65.09)
Validate: [60/79]	Time  0.214 ( 0.318)	Loss 7.1562e+01 (5.6247e+01)	Prompt Acc@1  64.06 ( 65.25)
Validate: [70/79]	Time  0.213 ( 0.303)	Loss 4.6562e+01 (5.5116e+01)	Prompt Acc@1  62.50 ( 65.25)
 * Prompt Acc@1 65.130
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 1, 1]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 6)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  75
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:20,  6.41s/it]  3%|▎         | 2/79 [00:06<03:32,  2.76s/it]  4%|▍         | 3/79 [00:06<02:01,  1.60s/it]  5%|▌         | 4/79 [00:07<01:18,  1.05s/it]  6%|▋         | 5/79 [00:07<00:55,  1.33it/s]  8%|▊         | 6/79 [00:07<00:41,  1.77it/s]  9%|▉         | 7/79 [00:07<00:32,  2.22it/s] 10%|█         | 8/79 [00:07<00:26,  2.65it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.07it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.45it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.76it/s] 15%|█▌        | 12/79 [00:08<00:16,  4.00it/s] 16%|█▋        | 13/79 [00:08<00:15,  4.19it/s] 18%|█▊        | 14/79 [00:09<00:14,  4.35it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.45it/s] 20%|██        | 16/79 [00:09<00:13,  4.52it/s] 22%|██▏       | 17/79 [00:09<00:13,  4.54it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.59it/s] 24%|██▍       | 19/79 [00:10<00:12,  4.65it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.67it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.49it/s] 28%|██▊       | 22/79 [00:10<00:13,  4.19it/s] 29%|██▉       | 23/79 [00:11<00:13,  4.10it/s] 30%|███       | 24/79 [00:11<00:13,  4.23it/s] 32%|███▏      | 25/79 [00:11<00:12,  4.30it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.42it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.52it/s] 35%|███▌      | 28/79 [00:12<00:11,  4.58it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.61it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.65it/s] 39%|███▉      | 31/79 [00:12<00:10,  4.67it/s] 41%|████      | 32/79 [00:13<00:10,  4.68it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.68it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.69it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.69it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.68it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.67it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.68it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.69it/s] 51%|█████     | 40/79 [00:14<00:08,  4.69it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.71it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.70it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.69it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.69it/s] 57%|█████▋    | 45/79 [00:15<00:07,  4.69it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.59it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.61it/s] 61%|██████    | 48/79 [00:16<00:06,  4.62it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.64it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.66it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.68it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.68it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.68it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.68it/s] 75%|███████▍  | 59/79 [00:18<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.69it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.68it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.69it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.69it/s] 81%|████████  | 64/79 [00:19<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.67it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.68it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.69it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.70it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.70it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.71it/s] 92%|█████████▏| 73/79 [00:21<00:01,  4.70it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.70it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.70it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.68it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.64it/s] 99%|█████████▊| 78/79 [00:22<00:00,  4.66it/s]100%|██████████| 79/79 [00:23<00:00,  3.40it/s]
Validate: [ 0/79]	Time  6.421 ( 6.421)	Loss 3.6469e+01 (3.6469e+01)	Prompt Acc@1  75.00 ( 75.00)
Validate: [10/79]	Time  0.211 ( 0.777)	Loss 7.4812e+01 (5.6307e+01)	Prompt Acc@1  57.81 ( 63.85)
Validate: [20/79]	Time  0.243 ( 0.510)	Loss 6.1750e+01 (5.5103e+01)	Prompt Acc@1  64.06 ( 64.58)
Validate: [30/79]	Time  0.211 ( 0.418)	Loss 7.4562e+01 (5.6608e+01)	Prompt Acc@1  60.16 ( 64.36)
Validate: [40/79]	Time  0.211 ( 0.368)	Loss 4.5844e+01 (5.6310e+01)	Prompt Acc@1  72.66 ( 65.00)
Validate: [50/79]	Time  0.212 ( 0.338)	Loss 6.5750e+01 (5.7343e+01)	Prompt Acc@1  63.28 ( 64.86)
Validate: [60/79]	Time  0.214 ( 0.317)	Loss 7.1500e+01 (5.7079e+01)	Prompt Acc@1  64.84 ( 65.04)
Validate: [70/79]	Time  0.212 ( 0.303)	Loss 4.4656e+01 (5.5998e+01)	Prompt Acc@1  64.84 ( 65.06)
 * Prompt Acc@1 65.000
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2988, 0.2701, 0.7871, 0.7353, 0.5544],
          [0.0378, 0.1012, 0.2772, 0.4423, 0.0959],
          [0.2752, 0.9963, 0.3685, 0.7495, 0.3963],
          [0.4009, 0.8705, 0.0810, 0.1216, 0.6335],
          [0.1703, 0.5077, 0.4702, 0.7327, 0.9923]],

         [[0.2071, 0.6436, 0.2303, 0.2740, 0.1998],
          [0.2374, 0.7943, 0.1201, 0.1448, 0.6549],
          [0.6512, 0.8451, 0.9532, 0.9033, 0.2787],
          [0.0536, 0.1032, 0.4758, 0.9160, 0.0617],
          [0.7435, 0.2905, 0.0615, 0.8859, 0.7452]],

         [[0.7881, 0.3140, 0.8408, 0.2837, 0.6815],
          [0.4239, 0.4897, 0.1395, 0.2933, 0.3706],
          [0.5219, 0.5934, 0.4927, 0.9182, 0.9539],
          [0.3215, 0.0702, 0.6486, 0.1838, 0.0305],
          [0.4843, 0.7701, 0.1675, 0.7775, 0.6776]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 5, 5]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
Running robustness experiment on CIFAR100 with ./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar.
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 10)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:36,  6.63s/it]  3%|▎         | 2/79 [00:06<03:39,  2.85s/it]  4%|▍         | 3/79 [00:07<02:05,  1.66s/it]  5%|▌         | 4/79 [00:07<01:21,  1.09s/it]  6%|▋         | 5/79 [00:07<00:57,  1.30it/s]  8%|▊         | 6/79 [00:07<00:42,  1.72it/s]  9%|▉         | 7/79 [00:07<00:33,  2.17it/s] 10%|█         | 8/79 [00:08<00:27,  2.62it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.05it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.42it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.68it/s] 15%|█▌        | 12/79 [00:08<00:17,  3.94it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.15it/s] 18%|█▊        | 14/79 [00:09<00:15,  4.31it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.43it/s] 20%|██        | 16/79 [00:09<00:14,  4.50it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.51it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.57it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.61it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.61it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.63it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.66it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.67it/s] 30%|███       | 24/79 [00:11<00:11,  4.68it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.69it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.70it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.72it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.71it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.72it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.72it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.72it/s] 41%|████      | 32/79 [00:13<00:09,  4.71it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.69it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.70it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.69it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.67it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.67it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.68it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.68it/s] 51%|█████     | 40/79 [00:14<00:08,  4.66it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.65it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.66it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.65it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.66it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.66it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.66it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.67it/s] 61%|██████    | 48/79 [00:16<00:06,  4.69it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.68it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.69it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.69it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.69it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.69it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.69it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.69it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.68it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.65it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.66it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.67it/s] 81%|████████  | 64/79 [00:20<00:03,  4.68it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.69it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.68it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.68it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.68it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.67it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.67it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.67it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.68it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.68it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.67it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.66it/s]100%|██████████| 79/79 [00:23<00:00,  3.39it/s]
Validate: [ 0/79]	Time  6.634 ( 6.634)	Loss 3.0625e+01 (3.0625e+01)	Prompt Acc@1  76.56 ( 76.56)
Validate: [10/79]	Time  0.224 ( 0.799)	Loss 7.3312e+01 (5.4341e+01)	Prompt Acc@1  54.69 ( 63.85)
Validate: [20/79]	Time  0.214 ( 0.520)	Loss 5.1938e+01 (5.2863e+01)	Prompt Acc@1  63.28 ( 64.40)
Validate: [30/79]	Time  0.212 ( 0.421)	Loss 6.8938e+01 (5.4701e+01)	Prompt Acc@1  57.03 ( 63.79)
Validate: [40/79]	Time  0.215 ( 0.370)	Loss 4.5062e+01 (5.4256e+01)	Prompt Acc@1  69.53 ( 64.37)
Validate: [50/79]	Time  0.212 ( 0.340)	Loss 6.7438e+01 (5.5506e+01)	Prompt Acc@1  62.50 ( 63.96)
Validate: [60/79]	Time  0.218 ( 0.319)	Loss 6.4312e+01 (5.5233e+01)	Prompt Acc@1  61.72 ( 64.15)
Validate: [70/79]	Time  0.213 ( 0.304)	Loss 4.6594e+01 (5.4250e+01)	Prompt Acc@1  62.50 ( 64.21)
 * Prompt Acc@1 64.090
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for FixedPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='padding', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/padding_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for PadPrompter:
	Missing key(s) in state_dict: "pad_left", "pad_right", "pad_up", "pad_down". 
	Unexpected key(s) in state_dict: "patch". 
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=1, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
=> loaded checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar' (epoch 10)
Turning off gradients in both the image and the text encoder
Parameters to be updated:
"Parameters to be updated: {'prompt_learner.patch'}"
Number of prompt parameters:  3
Model evaluation w/o random noise
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:06<08:40,  6.67s/it]  3%|▎         | 2/79 [00:06<03:41,  2.87s/it]  4%|▍         | 3/79 [00:07<02:06,  1.66s/it]  5%|▌         | 4/79 [00:07<01:21,  1.09s/it]  6%|▋         | 5/79 [00:07<00:57,  1.29it/s]  8%|▊         | 6/79 [00:07<00:42,  1.72it/s]  9%|▉         | 7/79 [00:07<00:33,  2.17it/s] 10%|█         | 8/79 [00:08<00:27,  2.62it/s] 11%|█▏        | 9/79 [00:08<00:22,  3.05it/s] 13%|█▎        | 10/79 [00:08<00:20,  3.42it/s] 14%|█▍        | 11/79 [00:08<00:18,  3.73it/s] 15%|█▌        | 12/79 [00:09<00:16,  3.98it/s] 16%|█▋        | 13/79 [00:09<00:15,  4.18it/s] 18%|█▊        | 14/79 [00:09<00:14,  4.33it/s] 19%|█▉        | 15/79 [00:09<00:14,  4.45it/s] 20%|██        | 16/79 [00:09<00:13,  4.54it/s] 22%|██▏       | 17/79 [00:10<00:13,  4.53it/s] 23%|██▎       | 18/79 [00:10<00:13,  4.59it/s] 24%|██▍       | 19/79 [00:10<00:13,  4.59it/s] 25%|██▌       | 20/79 [00:10<00:12,  4.62it/s] 27%|██▋       | 21/79 [00:10<00:12,  4.65it/s] 28%|██▊       | 22/79 [00:11<00:12,  4.67it/s] 29%|██▉       | 23/79 [00:11<00:11,  4.69it/s] 30%|███       | 24/79 [00:11<00:11,  4.69it/s] 32%|███▏      | 25/79 [00:11<00:11,  4.70it/s] 33%|███▎      | 26/79 [00:11<00:11,  4.71it/s] 34%|███▍      | 27/79 [00:12<00:11,  4.70it/s] 35%|███▌      | 28/79 [00:12<00:10,  4.72it/s] 37%|███▋      | 29/79 [00:12<00:10,  4.72it/s] 38%|███▊      | 30/79 [00:12<00:10,  4.71it/s] 39%|███▉      | 31/79 [00:13<00:10,  4.72it/s] 41%|████      | 32/79 [00:13<00:09,  4.70it/s] 42%|████▏     | 33/79 [00:13<00:09,  4.71it/s] 43%|████▎     | 34/79 [00:13<00:09,  4.71it/s] 44%|████▍     | 35/79 [00:13<00:09,  4.70it/s] 46%|████▌     | 36/79 [00:14<00:09,  4.69it/s] 47%|████▋     | 37/79 [00:14<00:08,  4.69it/s] 48%|████▊     | 38/79 [00:14<00:08,  4.69it/s] 49%|████▉     | 39/79 [00:14<00:08,  4.69it/s] 51%|█████     | 40/79 [00:14<00:08,  4.68it/s] 52%|█████▏    | 41/79 [00:15<00:08,  4.68it/s] 53%|█████▎    | 42/79 [00:15<00:07,  4.68it/s] 54%|█████▍    | 43/79 [00:15<00:07,  4.67it/s] 56%|█████▌    | 44/79 [00:15<00:07,  4.68it/s] 57%|█████▋    | 45/79 [00:16<00:07,  4.68it/s] 58%|█████▊    | 46/79 [00:16<00:07,  4.68it/s] 59%|█████▉    | 47/79 [00:16<00:06,  4.69it/s] 61%|██████    | 48/79 [00:16<00:06,  4.68it/s] 62%|██████▏   | 49/79 [00:16<00:06,  4.68it/s] 63%|██████▎   | 50/79 [00:17<00:06,  4.67it/s] 65%|██████▍   | 51/79 [00:17<00:05,  4.68it/s] 66%|██████▌   | 52/79 [00:17<00:05,  4.68it/s] 67%|██████▋   | 53/79 [00:17<00:05,  4.69it/s] 68%|██████▊   | 54/79 [00:17<00:05,  4.69it/s] 70%|██████▉   | 55/79 [00:18<00:05,  4.69it/s] 71%|███████   | 56/79 [00:18<00:04,  4.70it/s] 72%|███████▏  | 57/79 [00:18<00:04,  4.67it/s] 73%|███████▎  | 58/79 [00:18<00:04,  4.68it/s] 75%|███████▍  | 59/79 [00:19<00:04,  4.69it/s] 76%|███████▌  | 60/79 [00:19<00:04,  4.70it/s] 77%|███████▋  | 61/79 [00:19<00:03,  4.69it/s] 78%|███████▊  | 62/79 [00:19<00:03,  4.69it/s] 80%|███████▉  | 63/79 [00:19<00:03,  4.69it/s] 81%|████████  | 64/79 [00:20<00:03,  4.70it/s] 82%|████████▏ | 65/79 [00:20<00:02,  4.69it/s] 84%|████████▎ | 66/79 [00:20<00:02,  4.69it/s] 85%|████████▍ | 67/79 [00:20<00:02,  4.69it/s] 86%|████████▌ | 68/79 [00:20<00:02,  4.68it/s] 87%|████████▋ | 69/79 [00:21<00:02,  4.67it/s] 89%|████████▊ | 70/79 [00:21<00:01,  4.68it/s] 90%|████████▉ | 71/79 [00:21<00:01,  4.68it/s] 91%|█████████ | 72/79 [00:21<00:01,  4.69it/s] 92%|█████████▏| 73/79 [00:22<00:01,  4.69it/s] 94%|█████████▎| 74/79 [00:22<00:01,  4.68it/s] 95%|█████████▍| 75/79 [00:22<00:00,  4.69it/s] 96%|█████████▌| 76/79 [00:22<00:00,  4.69it/s] 97%|█████████▋| 77/79 [00:22<00:00,  4.68it/s] 99%|█████████▊| 78/79 [00:23<00:00,  4.67it/s]100%|██████████| 79/79 [00:23<00:00,  3.39it/s]
Validate: [ 0/79]	Time  6.681 ( 6.681)	Loss 3.2312e+01 (3.2312e+01)	Prompt Acc@1  77.34 ( 77.34)
Validate: [10/79]	Time  0.214 ( 0.800)	Loss 7.2625e+01 (5.4744e+01)	Prompt Acc@1  56.25 ( 64.20)
Validate: [20/79]	Time  0.211 ( 0.521)	Loss 5.4594e+01 (5.3268e+01)	Prompt Acc@1  64.06 ( 64.66)
Validate: [30/79]	Time  0.211 ( 0.421)	Loss 6.9500e+01 (5.5021e+01)	Prompt Acc@1  57.03 ( 64.01)
Validate: [40/79]	Time  0.215 ( 0.370)	Loss 4.3406e+01 (5.4518e+01)	Prompt Acc@1  71.09 ( 64.58)
Validate: [50/79]	Time  0.214 ( 0.340)	Loss 6.7062e+01 (5.5700e+01)	Prompt Acc@1  61.72 ( 64.22)
Validate: [60/79]	Time  0.214 ( 0.319)	Loss 6.4312e+01 (5.5507e+01)	Prompt Acc@1  61.72 ( 64.40)
Validate: [70/79]	Time  0.213 ( 0.304)	Loss 4.6250e+01 (5.4482e+01)	Prompt Acc@1  62.50 ( 64.55)
 * Prompt Acc@1 64.450
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=5, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_5_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 5, 5]).
/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 16 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=16, epochs=1000, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='random_patch', prompt_size=10, text_prompt_template='A photo of a {}', root='./data', dataset='cifar100', image_size=224, test_noise=False, visualize_prompt=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume='./save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar', evaluate=True, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/random_patch_10_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Files already downloaded and verified
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
List of prompts:
['A photo of a apple',
 'A photo of a aquarium fish',
 'A photo of a baby',
 'A photo of a bear',
 'A photo of a beaver',
 'A photo of a bed',
 'A photo of a bee',
 'A photo of a beetle',
 'A photo of a bicycle',
 'A photo of a bottle',
 'A photo of a bowl',
 'A photo of a boy',
 'A photo of a bridge',
 'A photo of a bus',
 'A photo of a butterfly',
 'A photo of a camel',
 'A photo of a can',
 'A photo of a castle',
 'A photo of a caterpillar',
 'A photo of a cattle',
 'A photo of a chair',
 'A photo of a chimpanzee',
 'A photo of a clock',
 'A photo of a cloud',
 'A photo of a cockroach',
 'A photo of a couch',
 'A photo of a crab',
 'A photo of a crocodile',
 'A photo of a cup',
 'A photo of a dinosaur',
 'A photo of a dolphin',
 'A photo of a elephant',
 'A photo of a flatfish',
 'A photo of a forest',
 'A photo of a fox',
 'A photo of a girl',
 'A photo of a hamster',
 'A photo of a house',
 'A photo of a kangaroo',
 'A photo of a keyboard',
 'A photo of a lamp',
 'A photo of a lawn mower',
 'A photo of a leopard',
 'A photo of a lion',
 'A photo of a lizard',
 'A photo of a lobster',
 'A photo of a man',
 'A photo of a maple tree',
 'A photo of a motorcycle',
 'A photo of a mountain',
 'A photo of a mouse',
 'A photo of a mushroom',
 'A photo of a oak tree',
 'A photo of a orange',
 'A photo of a orchid',
 'A photo of a otter',
 'A photo of a palm tree',
 'A photo of a pear',
 'A photo of a pickup truck',
 'A photo of a pine tree',
 'A photo of a plain',
 'A photo of a plate',
 'A photo of a poppy',
 'A photo of a porcupine',
 'A photo of a possum',
 'A photo of a rabbit',
 'A photo of a raccoon',
 'A photo of a ray',
 'A photo of a road',
 'A photo of a rocket',
 'A photo of a rose',
 'A photo of a sea',
 'A photo of a seal',
 'A photo of a shark',
 'A photo of a shrew',
 'A photo of a skunk',
 'A photo of a skyscraper',
 'A photo of a snail',
 'A photo of a snake',
 'A photo of a spider',
 'A photo of a squirrel',
 'A photo of a streetcar',
 'A photo of a sunflower',
 'A photo of a sweet pepper',
 'A photo of a table',
 'A photo of a tank',
 'A photo of a telephone',
 'A photo of a television',
 'A photo of a tiger',
 'A photo of a tractor',
 'A photo of a train',
 'A photo of a trout',
 'A photo of a tulip',
 'A photo of a turtle',
 'A photo of a wardrobe',
 'A photo of a whale',
 'A photo of a willow tree',
 'A photo of a wolf',
 'A photo of a woman',
 'A photo of a worm']
=> loading checkpoint './save/models/random_patch_1_cifar100_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1/model_best.pth.tar'
state dict OrderedDict([('patch', tensor([[[[0.2537]],

         [[0.6741]],

         [[0.6142]]]], device='cuda:0'))])
Traceback (most recent call last):
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 156, in <module>
    main()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/.//robustness.py", line 143, in main
    learn = Learner(args)
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 60, in __init__
    self.resume_checkpoint()
  File "/home/lcur0630/Deep-Learning/assignment2/part2/learner.py", line 122, in resume_checkpoint
    self.vpt.prompt_learner.load_state_dict(checkpoint["state_dict"])
  File "/home/lcur0630/.conda/envs/dl2022/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1667, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for RandomPatchPrompter:
	size mismatch for patch: copying a param with shape torch.Size([1, 3, 1, 1]) from checkpoint, the shape in current model is torch.Size([1, 3, 10, 10]).
